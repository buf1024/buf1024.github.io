<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>http on BUF1024!!!</title>
    <link>https://luoguochun.cn/categories/http/</link>
    <description>Recent content in http on BUF1024!!!</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cn</language>
    <lastBuildDate>Fri, 28 Apr 2017 22:10:32 +0000</lastBuildDate><atom:link href="https://luoguochun.cn/categories/http/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>lwan http æœåŠ¡å™¨</title>
      <link>https://luoguochun.cn/post/2017-04-28-lwan-http-server/</link>
      <pubDate>Fri, 28 Apr 2017 22:10:32 +0000</pubDate>
      
      <guid>https://luoguochun.cn/post/2017-04-28-lwan-http-server/</guid>
      <description>&lt;h3 id=&#34;ç®€ä»‹&#34;&gt;ç®€ä»‹ &lt;a href=&#34;#%e7%ae%80%e4%bb%8b&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;æœåŠ¡å™¨ç«¯ç¨‹åºçš„è®¾è®¡æ¨¡å¼ä¸€èˆ¬æ¯”è¾ƒå›ºå®šï¼Œç›®å‰ä¸»è¦æœ‰ä¸¤ç§ä¸»è¦çš„è§£å†³æ–¹å¼ï¼Œä¸€ç§å¤šè¿›ç¨‹æ–¹å¼(è¿›ç¨‹æ± )ï¼Œå¦å¤–ä¸€ç§å¤šçº¿ç¨‹çš„æ–¹å¼(çº¿ç¨‹æ± )(P.S:è¯·å¿˜æ‰ä¸€ä¸ªè¿æ¥æˆ–ä¸€ä¸ªä¸šåŠ¡forkä¸€ä¸ªè¿›ç¨‹ï¼Œæˆ–èµ·ä¸€ä¸ªçº¿ç¨‹çš„æ–¹å¼ï¼Œç³»ç»Ÿå¼€é”€å¤ªå¤§)ï¼Œä¸¤ç§æ–¹å¼éƒ½é‡‡ç”¨äº†éé˜»å¡ioï¼Œå¤šè·¯å¤ç”¨(P.S:linuxå¹³å°ä¸ºæœ€é«˜æ•ˆçš„&lt;code&gt;epoll&lt;/code&gt;ï¼Œæ–°å‹apiï¼Œå¦‚&lt;code&gt;signalfd&lt;/code&gt;, &lt;code&gt;timerfd&lt;/code&gt;, &lt;code&gt;eventfd&lt;/code&gt;ç­‰ï¼Œä¹Ÿå¯ä»¥è¿›è¡Œ&lt;code&gt;epoll&lt;/code&gt;)ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºå¤šè¿›ç¨‹çš„æ¨¡å¼ï¼Œæœ‰äº›å®ç°æ˜¯ï¼Œèµ·ä¸€ä¸ªä¸»è¿›ç¨‹è¿›è¡Œç›‘å¬å’Œç®¡ç†ï¼Œå†èµ·Nä¸ª(N=cpuä¸ªæ•°)ä¸šåŠ¡è¿›ç¨‹ï¼Œå½“ä¸»è¿›ç¨‹&lt;code&gt;accept&lt;/code&gt;æˆåŠŸåï¼Œæ ¹æ®ä¸€å®šçš„ä¸šåŠ¡é€»è¾‘ï¼Œå°†fdå‘é€åˆ°ä¸šåŠ¡è¿›ç¨‹(P.S:å‘é€æ–¹å¼ç”¨&lt;code&gt;socketpair&lt;/code&gt;ï¼Œå‚è€ƒï¼š&lt;a href=&#34;https://github.com/buf1024/reinvent-wheel/blob/master/common/sock.c&#34;&gt;sock.c&lt;/a&gt; &lt;code&gt;unix_domain_send_fd&lt;/code&gt;å’Œ&lt;code&gt;unix_domain_recv_fd&lt;/code&gt;)ï¼Œä¸šåŠ¡è¿›ç¨‹å¯¹æ¥æ”¶åˆ°åˆ°fdè¿›è¡Œ&lt;code&gt;epoll&lt;/code&gt;ã€‚å¯¹äºå¤šè¿›ç¨‹ï¼Œå¦å¤–ä¸€äº›å®ç°æ˜¯ï¼Œèµ·Nä¸ª(N=cpuä¸ªæ•°)ä¸šåŠ¡è¿›ç¨‹ï¼ŒåŒæ—¶Nä¸ªè¿›è¡Œåœ°ä½åŒç­‰ï¼ŒåŒæ—¶è¿›è¡Œ&lt;code&gt;epoll&lt;/code&gt;ï¼Œ&lt;code&gt;listen&lt;/code&gt;ï¼Œ&lt;code&gt;accept&lt;/code&gt;ç­‰(P.S:å¤šè¿›è¡Œè¿›è¡Œç›‘å¬å°†å¼•èµ·ç¾¤æƒŠæ•ˆåº”ï¼Œä½†åªæœ‰ä¸€ä¸ªè¿›ç¨‹&lt;code&gt;accept&lt;/code&gt;æˆåŠŸ)ã€‚è€Œå¤šçº¿ç¨‹çš„æ¨¡å¼ï¼Œåˆ™å’Œå¤šè¿›ç¨‹æ¨¡å¼ç±»ä¼¼ï¼Œæœ‰ä¸€ä¸ªä¸»çº¿ç¨‹è¿›è¡Œç›‘å¬å’Œç®¡ç†ï¼Œå†èµ·Nä¸ª(N=cpuä¸ªæ•°)ä¸šåŠ¡çº¿ç¨‹ï¼Œ&lt;strong&gt;å¹¶å°†ä¸šåŠ¡çº¿ç¨‹çš„è°ƒåº¦çº§åˆ«è®¾ç½®ä¸ºç³»ç»Ÿçº§åˆ«&lt;/strong&gt;ï¼Œè¿™ç‚¹éå¸¸é‡è¦ï¼Œå„ä¸ªä¸šåŠ¡çº¿ç¨‹ç¨‹è¿›è¡Œè¿›è¡Œ&lt;code&gt;epoll&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹å¹¶æ— æœ¬è´¨åŒºåˆ«ï¼Œå¤šçº¿ç¨‹çš„ä¼˜ç‚¹ä¸ªäººçœ‹æ¥ï¼Œæ•°æ®éƒ½åœ¨æ•´ä¸ªè¿›ç¨‹ç©ºé—´ï¼Œçº¿ç¨‹å†…æ•°æ®éƒ½å¯ä»¥å…±äº«ï¼Œéœ€è¦ç•™æ„å…±äº«æ•°æ®çš„äº’æ–¥è®¿é—®ï¼Œç¼ºç‚¹å°±æ˜¯è°ƒè¯•èµ·æ¥ç¨å¾®éº»çƒ¦ï¼Œè€Œå¤šè¿›ç¨‹çš„ä¼˜ç‚¹åœ¨äºä¸ªäººçœ‹æ¥ï¼Œè°ƒè¯•ç›¸å¯¹å¤šçº¿ç¨‹æ–¹ä¾¿ï¼Œç¼ºç‚¹å°±æ˜¯ä¸æ–¹ä¾¿è¿ç»´ã€‚(P.S:æ—§åŒäº‹å…¥èŒä¸€å®¶å¯¼èˆªçš„å…¬å¸ï¼Œä»–ä»¬çš„ç½‘ç»œæ¡†æ¶å°±æ˜¯å¤šçº¿ç¨‹æ¨¡å¼ï¼Œè€Œå…¬å¸çš„ï¼Œå¤šæ•°æ˜¯å¤šè¿›ç¨‹æ¨¡å¼ã€‚æ—§åŒäº‹æèµ·ï¼Œæ‰€ä»¥ç°åœ¨å†å›å¤´çœ‹çœ‹&lt;a href=&#34;https://github.com/lpereira/lwan&#34;&gt;lwan&lt;/a&gt;, å½“æ—¶åªæ˜¯çœ‹ï¼Œæ²¡è®°å½•ä¸‹æ¥ï¼Œç°åœ¨é‡æ–°è®°å½•ä¸€ä¸‹)&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/lpereira/lwan&#34;&gt;lwan&lt;/a&gt;æ˜¯ä¸ªéå¸¸è½»é‡çº§çš„httpæœåŠ¡å™¨(P.S:æ£€éªŒä½ æ˜¯å¦æŒæ¡äº†Cè¯­è¨€çš„æ ‡å‡†ï¼Œæ˜¯å¦èƒ½å®Œæ•´çš„å®ç°ä¸€ä¸ªhttpæœåŠ¡å™¨)ï¼Œä»£ç é‡åªæœ‰2Wå¤šè¡Œï¼Œæ¯”èµ·æˆç†Ÿç¨³å®šçš„&lt;a href=&#34;http://nginx.org/&#34;&gt;nginx&lt;/a&gt;ä»£ç é‡å°‘å¤ªå¤šäº†ï¼Œå½“ç„¶åŠŸèƒ½ä¹Ÿå°‘å¾ˆå¤šã€‚&lt;a href=&#34;https://github.com/lpereira/lwan&#34;&gt;lwan&lt;/a&gt;åœ¨16å¹´5æœˆä»½å·¦å³ä¸€æ®µæ—¶é—´åœ¨Cè¯­è¨€é¡¹ç›®æ’è¡Œæ¦œstarå¢åŠ æ•°æ’å‰åˆ—ã€‚ä¸ªäººè§‰å¾—ï¼Œ&lt;a href=&#34;https://github.com/lpereira/lwan&#34;&gt;lwan&lt;/a&gt;ï¼Œå®ƒé‡‡ç”¨å¤šçº¿ç¨‹æ¨¡å¼ï¼Œéµå¾ªäº†é«˜å¹¶å‘æœåŠ¡è®¾è®¡çš„æœ€åŸºæœ¬æ¨¡å¼ï¼Œè‡ªå·±è®¾è®¡ä¸€ä¸ªæ¯”è¾ƒæœ‰ç‰¹è‰²çš„&lt;a href=&#34;http://baike.baidu.com/link?url=3ojcT0gOp_oV_uDCAr0IYmAl6AziaFrQNodhpkS1DPpB7euef3LideO12NpZYhJWhuHYIw-2JqSlUUw_pvP9pa&#34;&gt;trie&lt;/a&gt;æ ‘çš„å®ç°ï¼Œå¯æ‰©å±•çš„æ¨¡å—ç¼–å†™ï¼ŒåŒæ—¶åˆ›æ–°çš„ä½¿ç”¨äº†åç¨‹ï¼ˆåç¨‹ï¼Œè‡ªå·±åœ¨å¾ˆä¹…ä¹‹å‰ä¹Ÿå…³æ³¨è¿‡ï¼Œå‚è€ƒ: &lt;a href=&#34;https://luoguochun.cn/2014/08/21/coroutine/&#34;&gt;coroutineåç¨‹&lt;/a&gt;ï¼‰ï¼Œè¿™æ˜¯æœ€å¤§çš„ç‰¹ç‚¹ã€‚å½“ç„¶ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œå®ƒè¿˜ä¸ç¨³å®šï¼Œä»è‡ªå·±å…³æ³¨æå‡ºçš„ç¬¬ä¸€ä¸ªissue, è¿˜æœ‰å¾ˆå¤šBUGï¼Œä»£ç æœ‰ä¸€äº›ä¸å¥½çš„é£æ ¼ï¼ˆå¦‚ç›¸å¯¹æ¯”è¾ƒå¤šçš„&lt;code&gt;goto&lt;/code&gt;è¯­å¥ï¼Œä¸€è¨€ä¸åˆå°±&lt;code&gt;abort&lt;/code&gt;ï¼‰ã€‚å°½ç®¡å¦‚æ­¤ï¼Œå®ƒè¿˜æ˜¯ä¸€ä¸ªéå¸¸å€¼å¾—å­¦ä¹ çš„webæœåŠ¡å™¨ã€‚ä¸‹é¢ç®€å•ç²—ç•¥å›é¡¾ä¸‹&lt;a href=&#34;https://github.com/lpereira/lwan&#34;&gt;lwan&lt;/a&gt;ï¼Œè¯¦ç»†äº†è§£çš„è¯ï¼Œå‚è€ƒä»£ç ï¼Œè‡ªå·±ä¹Ÿforkäº†ä¸€ä»½ï¼ŒåŠ äº†éƒ¨åˆ†æ³¨é‡Š&lt;a href=&#34;https://github.com/buf1024/lwan&#34;&gt;lwan&lt;/a&gt;ã€‚(P.S:è‡ªå·±å«åˆ«äººå»å­¦ä¹ ï¼Œæ²¡ç†ç”±è‡ªå·±å¿˜è®°äº†)&lt;/p&gt;
&lt;h3 id=&#34;å¤§è‡´å·¥ä½œæµç¨‹&#34;&gt;å¤§è‡´å·¥ä½œæµç¨‹ &lt;a href=&#34;#%e5%a4%a7%e8%87%b4%e5%b7%a5%e4%bd%9c%e6%b5%81%e7%a8%8b&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;a href=&#34;https://github.com/bu24/lwan&#34;&gt;lwan&lt;/a&gt;çš„å·¥ä½œæ¨¡å¼æ˜¯éå¸¸å…¸å‹çš„å¤šçº¿ç¨‹æ¨¡å‹ï¼Œç²—ç•¥ç”»ä¸€ä¸‹å®ƒçš„å·¥ä½œæµç¨‹ï¼š
&lt;img src=&#34;https://luoguochun.cn/img/lwan/workflow.png&#34; alt=&#34;lwanå·¥ä½œæµç¨‹&#34;&gt;
&lt;a href=&#34;https://github.com/bu24/lwan&#34;&gt;lwan&lt;/a&gt;æ€»å…±åŒ…æ‹¬ï¼Œä¸€ä¸ªä½çº§åˆ«çš„jobçº¿ç¨‹ï¼Œä¸»è¦äºèµ„æºæ¸…ç†ï¼Œä¸€ä¸ªä¸»çº¿ç¨‹ï¼Œä¸»è¦ç”¨äºæ¥æ”¶è¿æ¥å’Œåˆ†å‘è¿æ¥ï¼Œä»¥åŠN(Nå¯é…ç½®ï¼Œä¸€èˆ¬ç­‰äºCPUä¸ªæ•°)ä¸ªè°ƒåº¦çº§åˆ«ä¸ºè¿›ç¨‹çº§åˆ«çš„ä¸šåŠ¡å¤„ç†çº¿ç¨‹ã€‚&lt;a href=&#34;https://github.com/bu24/lwan&#34;&gt;lwan&lt;/a&gt;è¿›è¡Œçº¿ç¨‹åˆå§‹åŒ–æ˜¯ï¼Œä½¿ç”¨åˆ°äº†&lt;code&gt;pthread_barrier_*&lt;/code&gt;è¿™ç§æ•°æ®ç»“æ„ï¼Œ&lt;code&gt;pthread_barrier_*&lt;/code&gt;å…¶å®åªåšä¸”åªèƒ½åšä¸€ä»¶äº‹ï¼Œå°±æ˜¯å……å½“æ æ†ï¼ˆbarrieræ„ä¸ºæ æ†)ã€‚å½¢è±¡çš„è¯´å°±æ˜¯æŠŠå…ˆååˆ°è¾¾çš„å¤šä¸ªçº¿ç¨‹æŒ¡åœ¨åŒä¸€æ æ†å‰ï¼Œç›´åˆ°æ‰€æœ‰çº¿ç¨‹åˆ°é½ï¼Œç„¶åæ’¤ä¸‹æ æ†åŒæ—¶æ”¾è¡Œã€‚1ï¼‰&lt;code&gt;init&lt;/code&gt;å‡½æ•°è´Ÿè´£æŒ‡å®šè¦ç­‰å¾…çš„çº¿ç¨‹ä¸ªæ•°ï¼›2ï¼‰ &lt;code&gt;wait&lt;/code&gt;å‡½æ•°ç”±æ¯ä¸ªçº¿ç¨‹ä¸»åŠ¨è°ƒç”¨ï¼Œå®ƒå‘Šè¯‰æ æ†â€œæˆ‘åˆ°èµ·è·‘çº¿å‰äº†â€ã€‚&lt;code&gt;wait&lt;/code&gt;æ‰§è¡Œæœ«å°¾æ æ†ä¼šæ£€æŸ¥æ˜¯å¦æ‰€æœ‰äººéƒ½åˆ°æ æ†å‰äº†ï¼Œå¦‚æœæ˜¯ï¼Œæ æ†å°±æ¶ˆå¤±æ‰€æœ‰çº¿ç¨‹ç»§ç»­æ‰§è¡Œä¸‹ä¸€å¥ä»£ç ï¼›å¦‚æœä¸æ˜¯ï¼Œåˆ™æ‰€æœ‰å·²åˆ°&lt;code&gt;wait&lt;/code&gt;çš„çº¿ç¨‹åœåœ¨è¯¥å‡½æ•°ä¸åŠ¨ï¼Œå‰©ä¸‹æ²¡æ‰§è¡Œåˆ°wait()çš„çº¿ç¨‹ç»§ç»­æ‰§è¡Œï¼›3ï¼‰&lt;code&gt;destroy&lt;/code&gt;å‡½æ•°é‡Šæ”¾initç”³è¯·çš„èµ„æºã€‚&lt;/p&gt;
&lt;p&gt;jobçº¿ç¨‹åœ¨æ¯ä¸€æ¬¡å¾ªç¯è°ƒç”¨&lt;code&gt;sleep&lt;/code&gt;ç±»çš„å‡½æ•°ï¼Œè¿™ç±»å‡½æ•°æœ‰ä¸ªè‡´å‘½çš„ç¼ºç‚¹ï¼Œé‚£å°±æ˜¯ä¸èƒ½å“åº”ä¿¡å·ï¼Œè¿™å°±æ˜¯å¯¼è‡´&lt;a href=&#34;https://github.com/bu24/lwan&#34;&gt;lwan&lt;/a&gt;é€€å‡ºéå¸¸æ…¢çš„åŸå› ã€‚ä½¿ç”¨&lt;code&gt;pthread_cond_wait&lt;/code&gt;å¯ä»¥é¿å…è¯¥é—®é¢˜ï¼Œå·²ç»ä¿®æ”¹ï¼Œå¹¶è¿›è¡Œäº†pull requestï¼š&lt;a href=&#34;https://github.com/lpereira/lwan/pull/199&#34;&gt;quick quit optimize&lt;/a&gt;ã€‚ä¸šåŠ¡å¤„ç†çº¿ç¨‹é‡Œé¢å…¨éƒ¨ä½¿ç”¨åç¨‹è¿›è¡Œå¤„ç†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ•°æ®ç»“æ„&#34;&gt;æ•°æ®ç»“æ„ &lt;a href=&#34;#%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;ä¸€èˆ¬ç¨‹åºï¼Œä½¿ç”¨æ¯”è¾ƒå¤šçš„ä¸¤ä¸ªæ•°æ®ç»“æ„ä¸€ä¸ªæ˜¯&lt;code&gt;list&lt;/code&gt;é“¾è¡¨ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯&lt;code&gt;hashtable&lt;/code&gt;ã€‚&lt;code&gt;list&lt;/code&gt;æ²¡æœ‰å¤ªå¤šå¯è®²çš„ï¼Œè€Œ&lt;code&gt;hashtable&lt;/code&gt;çš„å®ç°ï¼Œåœ¨è¿™é‡Œå¯èƒ½ä¹Ÿä¸æ˜¯æœ€ä¼˜çš„ã€‚&lt;code&gt;hashtable&lt;/code&gt;æ¯”è¾ƒé«˜æ•ˆï¼Œè€Œä¸”ç»è¿‡å¤§é‡æ£€éªŒçš„æ˜¯redisçš„å®ç°æ–¹å¼ï¼Œæ¨èçœ‹è¿™ä¸ªï¼Œå…¬å¸å†…éƒ¨ä½¿ç”¨çš„åº“ä¹Ÿæ˜¯ä¿®æ”¹è¿™ä¸ªè€Œæ¥ã€‚ç½‘ä¸Šå¯¹&lt;a href=&#34;https://github.com/antirez/redis/blob/4.0/src/dict.c&#34;&gt;dict.c&lt;/a&gt;çš„åˆ†æå¾ˆå¤šï¼Œå¦‚ï¼š&lt;a href=&#34;http://huangz.iteye.com/blog/1455808&#34;&gt;Redis æºç åˆ†æï¼ˆ1ï¼‰ï¼šå­—å…¸å’Œå“ˆå¸Œè¡¨ï¼ˆdict.c å’Œ dict.hï¼‰&lt;/a&gt;ã€‚è¿™é‡Œä¸ç´¯èµ˜äº†ï¼Œå¤§ä½“æ¥è¯´ï¼šhash çš„å…¸å‹å®ç°æ–¹æ³•ï¼Œå®šä¹‰ä¸€ä¸ªå‡å¦‚é•¿åº¦ä¸ºlençš„æ•°ç»„ï¼Œæ¯ä¸ªæ•°ç»„é‡Œé¢ä¸ºleafçš„èŠ‚ç‚¹ï¼ŒleafèŠ‚ç‚¹ä¸ºä¸€é“¾è¡¨ç»“æ„ã€‚æ’å…¥å’ŒæŸ¥è¯¢å°±æ˜¯ï¼Œå…ˆè®¡ç®—keyçš„hashï¼Œhashå€¼å–æ¨¡lenï¼Œå¾—å‡ºæ•°æ®æ‰€åœ¨çš„ä½ç½®ï¼Œæ·»åŠ åˆ°leafèŠ‚ç‚¹åï¼ˆæ’å…¥ï¼‰ï¼Œæˆ–è€…åœ¨ä»leafé“¾è¡¨é‡Œé¢éå†ï¼ˆæŸ¥è¯¢ï¼Œç”±äºhashå†²çªï¼‰ï¼Œå¾—åˆ°æœ€ç»ˆçš„ç»“æœã€‚redisçš„&lt;code&gt;dict&lt;/code&gt;åŒ…æ‹¬ä¸¤ä¸ªè¿™ä¸ªæ ·çš„&lt;code&gt;hashtable&lt;/code&gt;ï¼Œé¦–å…ˆæ’å…¥æ•°æ®ä»0å·&lt;code&gt;hashtable&lt;/code&gt;æ’å…¥ï¼Œæ’å…¥æ—¶åˆ›å»ºï¼Œå½“0å·&lt;code&gt;hashtable&lt;/code&gt;å¢é•¿åˆ°ä¸€å®šçš„ç¨‹åº¦æˆ–æ¯”ä¾‹ï¼Œé‚£ä¹ˆå°±ä¼šåˆ›å»º1å·&lt;code&gt;hashtable&lt;/code&gt;ï¼Œå¹¶å°†0å·&lt;code&gt;hashtable&lt;/code&gt;è¿ç§»åˆ°è¿™ä¸ª&lt;code&gt;hashtable&lt;/code&gt;ï¼Œå¦‚æœæ­£åœ¨å‘ç”Ÿè¿ç§»ï¼Œé‚£ä¹ˆæ–°æ’å…¥çš„æ•°æ®å°±ä¼šæ’å…¥1å·&lt;code&gt;hashtable&lt;/code&gt;ï¼Œ0å·åˆ°1å·&lt;code&gt;hashtable&lt;/code&gt;çš„è¿ç§»æ˜¯åˆ†æ‘Šåˆ°&lt;code&gt;dict&lt;/code&gt;çš„æ¯ä¸ªæ“ä½œä¹‹ä¸­çš„ï¼Œå¹¶éé‡‡ç”¨é›†ä¸­å¼çš„è¿ç§»ã€‚å½“0å·&lt;code&gt;hashtable&lt;/code&gt;å…¨éƒ¨è¿ç§»åˆ°1å·&lt;code&gt;hashtable&lt;/code&gt;æ—¶ï¼Œé‚£ä¹ˆå°†0å·&lt;code&gt;hashtable&lt;/code&gt;åˆ é™¤ï¼Œå¹¶å°†1å·&lt;code&gt;hashtable&lt;/code&gt;å˜ä¸º0å·&lt;code&gt;hashtable&lt;/code&gt;ï¼Œ1å·&lt;code&gt;hashtable&lt;/code&gt;å˜ä¸ºNULLã€‚ç„¶ååœ¨é‡å¤è¿™æ ·ä¸€ä¸ªè¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://baike.baidu.com/link?url=zKneAm7OsFA-2VblcQ21Grh7ZYBSnSkaycwjc9q1Z5IbMNU0tdaqi71hgVjx7ZrO81aKwVYdnOAqOGl3VbU3U_&#34;&gt;trie&lt;/a&gt;æ ‘æ˜¯è¿™é‡Œçš„å¦å¤–ä¸€ä¸ªé‡è¦çš„æ•°æ®ç»“æ„ï¼Œå¾ˆå¤šwebæ¡†æ¶éƒ½ä¸¥é‡ä¾èµ–è¿™ç§æ•°æ®ç»“æ„ï¼Œä¸ªäººè§‰å¾—ï¼Œè¿™é‡Œå®ç°çš„&lt;code&gt;trie&lt;/code&gt;è¿˜æ˜¯æ¯”è¾ƒé«˜æ•ˆçš„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// trieæ•°æ®ç»“æ„å®šä¹‰
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lwan_trie_node&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lwan_trie_node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lwan_trie_leaf&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ref_count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lwan_trie_leaf&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lwan_trie_leaf&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lwan_trie&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lwan_trie_node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;free_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;//æŸ¥æ‰¾æˆ–æ’å…¥æ—¶ï¼Œå°±å·²ç»ç¡®è®¤ä½ç½®äº†    /* Traverse the trie, allocating nodes if necessary */
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;knode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;trie&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;knode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)])&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nf&#34;&gt;GET_NODE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;æ¯”å¦‚ï¼Œ5ï¼Œ58,12,123,1234,12345åœ¨å†…å­˜çš„å­˜å‚¨æƒ…å†µï¼ˆç®€åŒ–ï¼Œå‡è®¾&lt;code&gt;struct lwan_trie_node *next[4]&lt;/code&gt;ï¼‰ï¼š
&lt;img src=&#34;https://luoguochun.cn/img/lwan/trie.png&#34; alt=&#34;trieå†…å­˜å­˜å‚¨&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;åç¨‹coro&#34;&gt;åç¨‹coro &lt;a href=&#34;#%e5%8d%8f%e7%a8%8bcoro&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;ä¸šåŠ¡å¤„ç†çº¿ç¨‹é‡Œé¢å…¨éƒ¨ä½¿ç”¨åç¨‹è¿›è¡Œå¤„ç†çš„ã€‚åç¨‹åº”è¯¥å±äº&lt;a href=&#34;https://github.com/bu24/lwan&#34;&gt;lwan&lt;/a&gt;çš„æ ¸å¿ƒäº†ã€‚åç¨‹å¯ä»¥å‚è€ƒ&lt;a href=&#34;https://luoguochun.cn/2014/08/21/coroutine/&#34;&gt;coroutineåç¨‹&lt;/a&gt;ï¼Œé‡Œé¢æè¿°è¿™é‡Œçš„æœ‰å¾ˆå¤§åŒºåˆ«ï¼Œä½†æœ¬è´¨ä¸Šéƒ½æ˜¯éƒ½å¯¹&lt;code&gt;context&lt;/code&gt;ä¸åŒç¨‹åº¦å°è£…ï¼Œæˆ–ç”¨æ±‡ç¼–ï¼Œæˆ–ç›´æ¥ç”¨ç³»ç»Ÿå‡½æ•°ã€‚è¿™é‡Œçš„coroå®šä¹‰äº†ä¸€ä¸ª&lt;code&gt;struct coro_defer_array defer;&lt;/code&gt;ï¼Œç”¨äº&lt;code&gt;connection&lt;/code&gt;è¶…æ—¶æˆ–åç¨‹è¢«æ¸…ç†æ—¶ï¼Œå†…éƒ¨èµ„æºçš„æ¸…ç†ã€‚å…·ä½“åç¨‹ä¸å†è¯¦è¿°ã€‚&lt;/p&gt;
&lt;p&gt;åç¨‹æœ¬èº«æ¦‚å¿µå¹¶ä¸éš¾å¤æ‚ï¼Œå¦‚æœç†Ÿæ‚‰è¿™ç§ç¼–ç¨‹æ¨¡å¼ï¼Œé‚£ä¹ˆéé˜»å¡ç¼–ç¨‹æ¨¡å¼å°†å¯ä»¥ç”¨é¡ºåºç¼–ç¨‹çš„æ–¹å¼æ¥æ€è€ƒï¼Œå¯¹ç¨‹åºå‘˜çš„æ€è€ƒçš„è§’åº¦å’Œä¸šåŠ¡é€»è¾‘çš„ç†è§£å°†æœ‰å¾ˆå¤§çš„æå‡(éé˜»å¡çš„æ–¹å¼æ—¶ï¼Œå½“ä¸šåŠ¡æµç¨‹éœ€è¦è¿›è¡Œé˜»å¡æ—¶ï¼Œæ¯”å¦‚éœ€è¦è¿æ¥ç¬¬ä¸‰æ–¹ç³»ç»Ÿè¯·æ±‚æ•°æ®ï¼Œé‚£ä¹ˆä¸šåŠ¡å½“å‰çš„çŠ¶æ€å¯èƒ½éœ€è¦ä¿å­˜ä¸‹æ¥ï¼Œå½“ç¬¬ä¸‰æ–¹ç³»ç»Ÿåº”ç­”æ—¶ï¼Œå†æ¢å¤çŠ¶æ€ï¼Œè¿›è¡Œä¸‹ä¸€æ­¥å¤„ç†ï¼Œè¿™æ ·ï¼Œä¸šåŠ¡æµç¨‹å°±å˜æˆä¸€æ®µä¸€æ®µçš„äº†)ã€‚ä½†æ˜¯åç¨‹å¹¶æ²¡æœ‰å¤§è§„æ¨¡çš„ä½¿ç”¨ï¼Œ&lt;a href=&#34;http://blog.codingnow.com/&#34;&gt;é£äº‘&lt;/a&gt;ä¹Ÿæ›¾ä»‹ç»è¿‡ï¼Œåœ¨æ¨å¹¿åæˆæ¦‚å¿µæ—¶ï¼Œé‡åˆ°äº†å¾ˆå¤šé—®é¢˜(å…·ä½“å‡ºå¤„å·²å¿˜è®°)ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨åç¨‹å¿…é¡»é€‚å½“è¯„ä¼°ç¨‹åº&lt;code&gt;STACK&lt;/code&gt;çš„å¤§å°ï¼Œ&lt;a href=&#34;https://github.com/lpereira/lwan&#34;&gt;lwan&lt;/a&gt;é‡Œé¢æ˜¯å›ºå®šå®šä¹‰ä¸º&lt;code&gt;#define PTHREAD_STACK_MIN	16384&lt;/code&gt;ï¼Œåç¨‹åˆ†é…çš„&lt;code&gt;STACK&lt;/code&gt;ä¸º&lt;code&gt;((3 * (PTHREAD_STACK_MIN)) / 2)&lt;/code&gt;æˆ–&lt;code&gt;#define CORO_STACK_MIN         (5 * (PTHREAD_STACK_MIN))&lt;/code&gt;ï¼Œè¿™æ ·é‚£ä¹ˆå¦‚æœåœ¨åç¨‹åˆ‡æ¢å‡½æ•°é‡Œé¢å®šä¹‰ä¸€ä¸ªæ¯”è¾ƒå¤§çš„ä¸´æ—¶å˜é‡ï¼Œå¦‚&lt;code&gt;char tmp[1024000]&lt;/code&gt;é‚£ä¹ˆç¨‹åºå¿…æŒ‚äº†ï¼Œå› ä¸ºæ ˆæº¢å‡ºäº†ã€‚æ‰€ä»¥ä½¿ç”¨åç¨‹éœ€è¦è€ƒè™‘&lt;code&gt;STACK&lt;/code&gt;æˆ–è€ƒè™‘åŠ¨æ€åˆ†é…å†…å­˜ï¼ŒåŠ¨æ€åˆ†é…å†…å­˜è¿˜éœ€è¦è€ƒè™‘é‡Šæ”¾é—®é¢˜(å‚è€ƒ lwan-coro.c &lt;code&gt;coro_defer&lt;/code&gt;)ã€‚å¦å¤–ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œç¨‹åºcoredumpæ—¶ï¼Œç”¨gdbè¿›è¡Œè°ƒè¯•ï¼Œå‘ç°ç”¨&lt;code&gt;bt&lt;/code&gt;è¿›è¡Œè°ƒç”¨å †æ ˆæŸ¥çœ‹æ—¶ï¼Œæœ‰éƒ¨åˆ†æ˜¯ä¹±çš„ï¼Œä¸æ–¹ä¾¿é—®é¢˜å®šä½ã€‚æˆ‘æƒ³è¿™äº›æœ‰å¯èƒ½æ˜¯åç¨‹æ²¡æœ‰è¢«å¤§è§„æ¨¡æ¨å¹¿çš„åŸå› ä¹‹ä¸€å§ï¼Ÿ&lt;/p&gt;
&lt;h3 id=&#34;æ¨¡å—å¤„ç†&#34;&gt;æ¨¡å—å¤„ç† &lt;a href=&#34;#%e6%a8%a1%e5%9d%97%e5%a4%84%e7%90%86&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;a href=&#34;https://github.com/lpereira/lwan&#34;&gt;lwan&lt;/a&gt;é€šè¿‡æ¨¡å—è¿›è¡Œè‡ªèº«çš„æ‰©å±•ï¼Œè‡ªå·±æœ¬èº«ä¹Ÿå®ç°äº†ä¸€äº›æ¨¡å—ã€‚&lt;code&gt;lwan-mod&lt;/code&gt;å¼€å¤´çš„æ–‡ä»¶éƒ½æ˜¯å®ƒçš„æ¨¡å—ã€‚ä¸ªäººç¼–å†™æ¨¡å—ï¼Œåªæœ‰å®ç°ç›¸å…³çš„å‡½æ•°ï¼Œç›´æ¥ç¼–è¯‘æˆåŠ¨æ€åº“å³å¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// æ¨¡å—éœ€å®ç°å‡½æ•°ï¼Œæ¨¡å—åå¯åœ¨é…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®ï¼Œè¿”å›const struct lwan_module *ç»“æ„ä½“æŒ‡é’ˆ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lwan_module&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;lwan_module_æ¨¡å—å&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;/*lwan æ¨¡å—æ˜¯å‡½æ•°åä¸º lwan_module_æ¨¡å—åçš„å‡½æ•°ï¼Œå†…ç½®æ¨¡å—ä½¿ç”¨-rdynamicç¼–è¯‘è¿›å¯æ‰§è¡Œç¨‹åºå†…*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lwan_module&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;init&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;init_from_hash&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;hash&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;hash&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shutdown&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;parse_conf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;config&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// http è¯·æ±‚å¤„ç†å‡½æ•°
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;enum&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;lwan_http_status&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lwan_request&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;request&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lwan_response&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;response&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;enum&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lwan_handler_flags&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;flags&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// å¤„ç†æ ‡å¿—
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;è‡ªå·±å®ç°ä¸€ä¸ªhelloworldæ¨¡å—å¯å‚è€ƒï¼š&lt;a href=&#34;https://github.com/buf1024/lwan/blob/master/common/lwan-mod-helloworld.c&#34;&gt;helloworld&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;é…ç½®æ–‡ä»¶&#34;&gt;é…ç½®æ–‡ä»¶ &lt;a href=&#34;#%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;a href=&#34;https://github.com/lpereira/lwan&#34;&gt;lwan&lt;/a&gt;æä¾›çš„é…ç½®æ–‡ä»¶ï¼Œå¹¶æ²¡æœ‰è¦†ç›–å…¨éƒ¨çš„é…ç½®ï¼Œä¸‹é¢ä»ä»£ç ä¸­æå–çš„é…ç½®æ–‡ä»¶ï¼Œä¾›å‚è€ƒä¸‹(è§å›½ä¸å°‘å¼€æºé¡¹ç›®é‡‡ç”¨è¿™ç§é…ç½®æ ¼å¼ï¼Œä½†è²Œä¼¼æ²¡æœ‰å…·ä½“å®šä¹‰è¿™æ˜¯é‚£ç§æ ¼å¼ï¼Œæ‰€æœ‰è‡ªå·±å«è¿™ç§æ ¼å¼ä¸º&lt;code&gt;tson&lt;/code&gt;ï¼Œå¹¶å†™äº†ä¸€ä¸ªç®€å•è§£æçš„ä»£ç ï¼Œå‚è€ƒ&lt;a href=&#34;https://github.com/buf1024/reinvent-wheel/blob/master/common/tson.c&#34;&gt;tson&lt;/a&gt;)ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;71
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;#true on yes    ä»¥åŠé0æ•°å€¼ï¼Œè¢«è§£æä¸ºtrue
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;#false off no   ä»¥åŠé0æ•°å€¼ï¼Œè¢«è§£æä¸ºfalse
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Timeout in seconds to keep a connection alive.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;keep_alive_timeout = 15
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Set to true to not print any debugging messages. (Only effective in
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# release builds.)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;quiet = false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Set SO_REUSEPORT=1 in the master socket.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;reuse_port = true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Disable HAProxy&amp;#39;s PROXY protocol by default. Only enable if needed.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;proxy_protocol = false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;allow_cors=false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Value of &amp;#34;Expires&amp;#34; header. Default is 1 month and 1 week.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;expires = 1M 1w
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;#error_template = error.html
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# post æ•°æ®å¤§å°ï¼Œæœ€å¤šä¸º128m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;max_post_data_size=40960000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;allow_temp_files=true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# Number of I/O threads. Default (0) is number of online CPUs.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;threads = 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;#éœ€è¦rootç”¨æˆ·ï¼Œæˆ–è€…æœ‰rootæƒé™çš„ç”¨æˆ·æ‰§è¡Œï¼Œ è¯¥sectionå¿…é¡»åœ¨æ‰€ä»¥listenerä¹‹å‰
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;#straitjacket {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;#  # åˆ‡æ¢è¿è¡Œæ”¹ç¨‹åºçš„ç”¨æˆ·
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;#  user = heidong
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;#  # ç¨‹åºè¿è¡Œçš„æ ¹ç›®å½•
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;#  chroot = /home/heidong
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;#}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# sectionè§£æ  ip:port
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;listener *:8080 {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # é…ç½®ä¸‰ç§æ–¹å¼ 1. prefix è·¯å¾„ 1. &amp;amp;handler è·¯å¾„ 3. module è·¯å¾„ã€‚ åªæœ‰é…ç½®ä¸ºmoduleçš„ï¼Œæ–¹æœ‰å›è°ƒå‡½æ•°è¯»é‡Œé¢é…ç½®é¡¹ç›®
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    #prefix / {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    #        #handlerå’Œmoduleåªèƒ½æ˜¯ä¸€ä¸ª, module ä¸ºå‡½æ•°åä¸º lwan_module_{module_name}çš„æ¨¡å—
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    #        module = module_name
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    #        #handler å‡½æ•°åŸå‹ lwan_http_status_t (*handler)(lwan_request_t *request, lwan_response_t *response, void *data);
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    #        handler  = handler_symbol
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    #        authorization basic {     #ç›®å‰åªæ”¯æŒbasic
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    #            realm=value #é»˜è®¤Lwan
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    #            passowrd_file=file #é»˜è®¤htpasswd
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    #        }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    #}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    # é…ç½®handler
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    #&amp;amp;handler / {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    #}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    serve_files / {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            path = ./
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            # When requesting for file.ext, look for a smaller/newer file.ext.gz,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            # and serve that instead if `Accept-Encoding: gzip` is in the
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            # request headers.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            serve precompressed files = true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            # é…ç½®è¯¥sectionåï¼Œå¿…é¡»æˆæƒæ‰å¯è®¿é—®è¯¥url
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            authorization basic {     #ç›®å‰åªæ”¯æŒbasic
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                realm=æµ‹è¯•æµ‹è¯• #é»˜è®¤Lwan
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                password_file=/home/heidong/privt/proj/lwan/htpasswd.conf #é»˜è®¤htpasswdï¼Œæ•°æ®æ ¼å¼ä¸ºï¼šç”¨æˆ·å=å¯†ç 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id=&#34;å…¶ä»–&#34;&gt;å…¶ä»– &lt;a href=&#34;#%e5%85%b6%e4%bb%96&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;è¿™é‡Œåªæ˜¯ç®€å•è¿‡ä¸€äº›lwanæœ€åŸºæœ¬çš„ä¸œè¥¿ï¼Œæ²¡æœ‰è¯¦ç»†çš„è¿‡é‡Œé¢çš„å…¶ä»–æ–¹é¢ï¼Œä»”ç»†åˆ†æçš„è¯è¿˜æœ‰å¾ˆå¤šä¸œè¥¿å¯ä»¥å­¦ï¼Œè¿™é‡Œä¸å†ç½—åˆ—äº†ï¼Œæš‚æ—¶å…ˆè¿™æ ·ã€‚&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>
