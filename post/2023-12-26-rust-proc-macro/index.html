<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width,minimum-scale=1">




<title>rust è¿‡ç¨‹å® | BUF1024!!!</title>
<link rel="canonical" href="https://luoguochun.cn/post/2023-12-26-rust-proc-macro/">
<meta name="description" content="ç®€ä»‹ ğŸ”—Rust ç¼–ç¨‹è¯­è¨€é‡Œé¢æœ‰ä¸¤ç§å®ç³»ç»Ÿï¼Œä¸€ç§æ˜¯å£°æ˜å®ï¼ˆDeclarative Macrosï¼‰ï¼Œå¦ä¸€ç§ä¸ºè¿‡ç¨‹å®ï¼ˆProcedural Macros" />
<meta property="og:type" content="article" />
<meta property="og:title" content="rust è¿‡ç¨‹å® | BUF1024!!!" />
<meta property="og:url" content="https://luoguochun.cn/post/2023-12-26-rust-proc-macro/" />
<meta property="og:description" content="ç®€ä»‹ ğŸ”—Rust ç¼–ç¨‹è¯­è¨€é‡Œé¢æœ‰ä¸¤ç§å®ç³»ç»Ÿï¼Œä¸€ç§æ˜¯å£°æ˜å®ï¼ˆDeclarative Macrosï¼‰ï¼Œå¦ä¸€ç§ä¸ºè¿‡ç¨‹å®ï¼ˆProcedural Macros" />








<link rel="stylesheet" href="/lib/icofont/icofont.min.css" />
<link rel="stylesheet" href="/css/syntax.css" />
<link rel="stylesheet" href="/css/style.css" />
<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />

</head>

<body>
    <header class="header-wrapper">
    <div class="header">
        <a class="site-title" href="https://luoguochun.cn">BUF1024!!!</a>

        <nav class="menu">
            
                <div class="menu-item">
                    
                        <a href="/">ä¸»é¡µ</a>
                    
                </div>
            
                <div class="menu-item">
                    
                        <a href="/post/">æ–‡ç« </a>
                    
                </div>
            
                <div class="menu-item">
                    
                        <a href="/tags/">æ ‡ç­¾</a>
                    
                </div>
            
                <div class="menu-item">
                    
                        <a href="/categories/">åˆ†ç±»</a>
                    
                </div>
            
                <div class="menu-item">
                    
                        <a href="/about/">å…³äº</a>
                    
                </div>
            
        </nav>
    </div>
</header>

    <main class="main-wrapper">

        <div class="main">
            <div style="display: flex; flex-direction: column;"></div>
                

<section class="single">
    <h1 class="title">rust è¿‡ç¨‹å®</h1>

    <div class="tip">
        <time datetime="2023-12-26 16:00:10 &#43;0800 CST">2023/12/26</time>
        <span class="split">Â·</span>
        <span> 5762 words </span>
        <span class="split">Â·</span>
        <span>
            12 minutes to read
        </span>
    </div>

    <div class="taxonomies">
        
        <div>
            Categories:
            
                <a href="/categories/rust">rust</a>
            
        </div>
        

        
            <div>
                Tags:
                
                    <a href="/tags/rust">rust</a>
                
            </div>
        
    </div>

    <hr />

    <div class="content">
        <h3 id="ç®€ä»‹">ç®€ä»‹ <a href="#%e7%ae%80%e4%bb%8b" class="anchor">ğŸ”—</a></h3><p><a href="https://www.rust-lang.org/zh-CN/">Rust</a> ç¼–ç¨‹è¯­è¨€é‡Œé¢æœ‰ä¸¤ç§å®ç³»ç»Ÿï¼Œä¸€ç§æ˜¯å£°æ˜å®ï¼ˆ<a href="https://doc.rust-lang.org/book/ch19-06-macros.html#declarative-macros-with-macro_rules-for-general-metaprogramming">Declarative Macros</a>ï¼‰ï¼Œå¦ä¸€ç§ä¸ºè¿‡ç¨‹å®ï¼ˆ<a href="https://doc.rust-lang.org/book/ch19-06-macros.html#procedural-macros-for-generating-code-from-attributes">Procedural Macros</a>ï¼‰ã€‚å£°æ˜å®å’Œè¿‡ç¨‹å®æ˜¯ä¸¤ç§åŸºæœ¬ä¸Šå®Œå…¨ä¸ä¸€æ ·çš„å®ç³»ç»Ÿï¼Œç¼–å†™çš„æ–¹å¼ä¹Ÿå®Œå…¨ä¸ä¸€è‡´ï¼Œä½¿ç”¨æ–¹å¼é™¤äº†å‡½æ•°å¼å¤–ä¹Ÿä¸ä¸€è‡´ã€‚å…³äºå£°æ˜å®å­¦ä¹ ï¼Œ<a href="https://zjp-cn.github.io/tlborm/introduction.html">Rust å®å°å†Œ</a> é‡Œé¢æœ‰æ¯”è¾ƒè¯¦ç»†çš„è¯´æ˜ï¼Œè¿™é‡Œä¸å†å•°å—¦ã€‚è€Œå¯¹äºè¿‡ç¨‹å®ï¼Œç½‘ä¸Šæ˜¯å¯ä»¥æœç´¢åˆ°çš„èµ„æ–™åˆ™ç›¸å¯¹è¾ƒå°‘ï¼Œç³»ç»Ÿä»‹ç»å­¦ä¹ çš„èµ„æ–™å°±æ›´åŠ å°‘äº†ã€‚</p>
<p>è¿‡ç¨‹å®æ‰€åšçš„äº‹æƒ…åˆ™æ˜¯ä»è¾“å…¥ä¸­è·<strong>å–åˆ°æ ‡è®°æµ</strong>ï¼Œ<strong>å¤„ç†è¿™äº›æ ‡è®°æµæˆ–è€…ç”Ÿæˆæ–°çš„æ ‡è®°æµ</strong>ï¼Œç„¶åå°†å¤„ç†åçš„æ ‡è®°æµè¿”å›ç»™ç¼–è¯‘å™¨ä½œä¸‹ä¸€æ­¥çš„å¤„ç†ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿‡ç¨‹å®æ“ä½œçš„æ˜¯<a href="https://www.rust-lang.org/zh-CN/">Rust</a> <code>AST</code>ï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰ï¼Œæ‰€ä»¥å³ä½¿æ˜¯åœ¨å®é‡Œé¢ï¼Œä¹Ÿå¿…é¡»æ˜¯åˆæ³•<a href="https://www.rust-lang.org/zh-CN/">Rust</a>çš„è¯­æ³•ç»“æ„ã€‚è¿™ä¹Ÿå°±æ„å‘³ç€ï¼Œè§£æè¿‡ç¨‹å®çš„è¿‡ç¨‹ä¸­ï¼Œ<code>var</code>è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªåˆæ³•çš„æ ‡è¯†ç¬¦ï¼Œè€Œ<code>6var</code>åˆ™æ˜¯éæ³•çš„ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« æ˜¯ï¼Œå¯¹è¿‡ç¨‹å®è¿›è¡Œä¸€äº›ä¸å®Œå…¨çš„æ¢è®¨å’Œå­¦ä¹ ã€‚</p>
<h3 id="ä¸‰ç§è¿‡ç¨‹å®å½¢å¼">ä¸‰ç§è¿‡ç¨‹å®å½¢å¼ <a href="#%e4%b8%89%e7%a7%8d%e8%bf%87%e7%a8%8b%e5%ae%8f%e5%bd%a2%e5%bc%8f" class="anchor">ğŸ”—</a></h3><p>è¿‡ç¨‹å®å¿…é¡»æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„åº“ï¼ˆå¾ˆå¤šå¼€æºé¡¹ç›®å–œæ¬¢ç”¨<code>xxx_derive</code>çš„åç§°å‘½åï¼‰ï¼Œè¿™ä¸ªåº“åªå¯¼å‡ºè¿‡ç¨‹å®çš„å‡½æ•°ï¼Œè€Œè¿™ä¸ªå®æ˜¯è¢«ç¼–è¯‘å™¨è°ƒç”¨çš„ã€‚<code>Cargo.toml</code>é‡Œé¢å¿…é¡»æœ‰ä»¥ä¸‹å†…å®¹è¡¨æ˜æ˜¯ä¸€ä¸ªè¿‡ç¨‹å®ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="p">[</span><span class="n">lib</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">proc</span><span class="o">-</span><span class="kr">macro</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><a href="https://doc.rust-lang.org/stable/proc_macro/index.html"><code>proc_macro</code></a> æ˜¯ <a href="https://www.rust-lang.org/zh-CN/">Rust</a> ç¼–è¯‘å™¨æä¾›çš„ç¼–å†™è¿‡ç¨‹å®æ‰€éœ€çš„ç±»å‹å’Œå·¥å…·ï¼Œè¿‡ç¨‹å®æœ‰ä»¥ä¸‹ä¸‰ç§è¡¨ç¤ºå½¢å¼ï¼š</p>
<h4 id="derive-å¼"><code>derive</code> å¼ <a href="#derive-%e5%bc%8f" class="anchor">ğŸ”—</a></h4><ol>
<li>å‡½æ•°å¸¦æœ‰<code>#[proc_macro_derive(Name)]</code> å±æ€§æˆ–è€…<code> #[proc_macro_derive(Name, attributes(attr))]</code>å±æ€§</li>
<li>å‡½æ•°ç­¾åä¸º <code>pub fn xxxx (proc_macro::TokenStream) -&gt; proc_macro::TokenStream</code></li>
</ol>
<p>å‡½æ•°çš„åç§°å«ä»€ä¹ˆå¹¶ä¸é‡è¦ï¼Œä½¿ç”¨æ—¶æ˜¯ä½¿ç”¨<code>proc_macro_derive</code>é‡Œé¢çš„åç§°ï¼Œå¦‚ä¸‹ä¾‹å­</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="cp">#[proc_macro_derive(Getters, attributes(getter))]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">getters</span><span class="p">(</span><span class="n">input</span>: <span class="nc">TokenStream</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">TokenStream</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c1">//...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="cp">#[derive(Getters)]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">struct</span> <span class="nc">Test</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="cp">#[getter(name=get_name)]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">name</span>: <span class="nb">String</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="å‡½æ•°å¼">å‡½æ•°å¼ <a href="#%e5%87%bd%e6%95%b0%e5%bc%8f" class="anchor">ğŸ”—</a></h4><ol>
<li>å‡½æ•°å¸¦æœ‰ <code>#[proc_macro] </code>å±æ€§</li>
<li>å‡½æ•°ç­¾åä¸º <code>pub fn xxx (proc_macro::TokenStream) -&gt; proc_macro::TokenStream</code></li>
</ol>
<p>å‡½æ•°çš„åç§°å°±æ˜¯ä½¿ç”¨æ—¶åç§°ï¼Œå¦‚ä¸‹ä¾‹å­ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="cp">#[proc_macro]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">lazy_static</span><span class="p">(</span><span class="n">input</span>: <span class="nc">TokenStream</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">TokenStream</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c1">//...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨æ–¹å¼å’Œå£°æ˜å®è°ƒç”¨ä¸€æ‘¸ä¸€æ ·</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="fm">lazy_static!</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="c1">//...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="å±æ€§å¼">å±æ€§å¼ <a href="#%e5%b1%9e%e6%80%a7%e5%bc%8f" class="anchor">ğŸ”—</a></h4><ol>
<li>å‡½æ•°å¸¦æœ‰<code>#[proc_macro_attribute]</code>å±æ€§</li>
<li>å‡½æ•°ç­¾åä¸º <code>pub fn xxx(proc_macro::TokenStream, proc_macro::TokenStream) -&gt; proc_macro::TokenStream</code></li>
</ol>
<p>å‡½æ•°çš„åç§°å°±æ˜¯ä½¿ç”¨æ—¶åç§°ï¼Œå¦‚ä¸‹ä¾‹å­ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="cp">#[proc_macro_attribute]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">retry</span><span class="p">(</span><span class="n">attr</span>: <span class="nc">TokenStream</span><span class="p">,</span><span class="w"> </span><span class="n">input</span>: <span class="nc">TokenStream</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">TokenStream</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c1">//...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨æ–¹å¼å’Œ<code>Python</code>è£…é¥°å™¨çš„ä½¿ç”¨æ–¹å¼ç±»ä¼¼</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="cp">#[retry(times=5, timeout=60s)]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">fetch_data</span><span class="p">(</span><span class="n">url</span>: <span class="nb">String</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="n">MyData</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c1">//...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸€èˆ¬æ¥è¯´ï¼Œ<code>derive</code> å¼æ˜¯å¯¹åŸæœ‰åŠŸèƒ½çš„æ‰©å±•ï¼Œ<strong>åŸæœ‰çš„å£°æ˜æ˜¯ä¿ç•™ä¸‹çš„</strong>ï¼Œæ›´å¤šæ˜¯åœ¨åŸæœ‰åŸºç¡€ä¸Š<strong>å¢åŠ åŠŸèƒ½</strong>ï¼Œæ¯”å¦‚å¢åŠ <code>impl</code>å‡½æ•°ï¼Œå¢åŠ æ³›å‹çº¦æŸç­‰ç­‰ã€‚<strong>å‡½æ•°å¼</strong>åˆ™æ›´å¤šçš„æ˜¯ç”¨äºè‡ªå®šä¹‰è¯­æ³•çš„è§£æï¼Œå¦‚æœå£°æ˜å®æè¿°è¯­æ³•å›°éš¾ä¸€èˆ¬å¯ä»¥è€ƒè™‘ç”¨å‡½æ•°å¼æ¥æ›¿ä»£ã€‚è€Œå±æ€§å¼åˆ™æ˜¯å®Œå…¨å¯¹åŸæœ‰åŠŸèƒ½çš„æ”¹å†™äº†ï¼Œå±äºæ›¿ä»£æ€§çš„ã€‚ç‰¹åˆ«éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>è¿‡ç¨‹å¹¶ä¸æ˜¯å«ç”Ÿæ€§</strong>çš„ï¼Œè¿™ç‚¹æ˜¯å’Œå£°æ˜å®ä¸ä¸€æ ·ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿‡ç¨‹å®å®ƒæ˜¯ä¼šæ±¡æŸ“å½“å‰æ¨¡å—ã€‚æ‰€ä»¥ï¼Œåœ¨è¿‡ç¨‹å®é‡Œé¢å®šä¹‰æˆ–ä½¿ç”¨ç±»å‹æ—¶ï¼Œå¿…é¡»è¦ç”¨å…¨è·¯å¾„çš„å½¢å¼ï¼Œè€Œè‡ªå®šç”Ÿæˆçš„å‡½æ•°å˜é‡ç­‰ç­‰å‘½åä¹Ÿè¦ç‰¹æ®Šè€ƒè™‘ï¼Œä»¥é˜²æ­¢æ±¡æŸ“äº†å½“å‰æ¨¡å—ã€‚</p>
<h3 id="quote-syn-proc_macro2ä»¥åŠtrybuildå’Œcargo-expandhttpsgithubcomdtolnaycargo-expand"><code>quote</code>, <code>syn</code>, <code>proc_macro2</code>ä»¥åŠ<code>trybuild</code>å’Œ<a href="https://github.com/dtolnay/cargo-expand"><code>cargo-expand</code></a> <a href="#quote-syn-proc_macro2%e4%bb%a5%e5%8f%8atrybuild%e5%92%8ccargo-expandhttpsgithubcomdtolnaycargo-expand" class="anchor">ğŸ”—</a></h3><p>ç¼–å†™è¿‡ç¨‹å®ï¼Œç¼–è¯‘å™¨åªæä¾›<a href="https://doc.rust-lang.org/stable/proc_macro/index.html"><code>proc_macro</code></a>è¿™ä¸ª<code>crate</code>ï¼Œä¸è¿‡å®ƒæ‰€æä¾›çš„åŠŸèƒ½éå¸¸æœ‰é™ï¼Œå•ç‹¬ä½¿ç”¨è¿™ä¸ªåº“çš„è¯ï¼Œç¼–å†™æ¯”è¾ƒå•°å—¦å’Œéº»çƒ¦ã€‚å› æ­¤å¤§ç¥<a href="https://github.com/dtolnay">dtolnay</a>æä¾›äº†<code>quote</code>, <code>syn</code>å’Œ<code>proc_macro2</code>è¿™ä¸‰ä¸ªåº“æ¥ç®€åŒ–è¿‡ç¨‹å®çš„ç¼–å†™ï¼Œæœ‰äº†è¿™ä¸‰ä¸ª<code>crate</code>ï¼Œç¼–å†™è¿‡ç¨‹å®å°±å¦‚åŒç¼–å†™æ™®é€šçš„ä»£ç ä¸€æ ·ï¼Œé™¤äº†è°ƒè¯•å›°éš¾ä¸€ç‚¹å¤–ï¼ŒåŸºæœ¬æ²¡ä»€ä¹ˆå·®åˆ«ã€‚è¿™ä¸‰ä¸ªåº“åŸºæœ¬æˆåŠŸç¼–å†™è¿‡ç¨‹å®äº‹å®ä¸Šçš„æ ‡å‡†ã€‚</p>
<p>åŒæ—¶ä¸ºäº†ä½¿ç¼–å†™è¿‡ç¨‹æ›´åŠ æ¸©æŸ”ç‚¹è€Œä¸è‡³äºæš´èºï¼Œ<a href="https://github.com/dtolnay">dtolnay</a>æä¾›äº†<code>trybuild</code>è¿™ä¸ªåº“ç”¨äºç¼–å†™å®çš„å•å…ƒæµ‹è¯•ï¼Œ<a href="https://github.com/dtolnay/cargo-expand"><code>cargo-expand</code></a>ç”¨äºè¿‡ç¨‹å®çš„å±•å¼€ã€‚</p>
<h4 id="proc_macro2"><code>proc_macro2</code> <a href="#proc_macro2" class="anchor">ğŸ”—</a></h4><p><a href="https://doc.rust-lang.org/stable/proc_macro/index.html"><code>proc_macro</code></a>æ‰€æä¾›çš„<code>TokenStream</code>å’Œ<code>quote</code>å’Œ<code>syn</code>æ‰€å¤„ç†çš„<code>TokenStream</code>æ˜¯ä¸å…¼å®¹çš„ï¼Œæ‰€ä»¥å¦å¤–å¢åŠ ä¸€ä¸ª <code>proc_macro2</code>ï¼Œç”¨äºå’Œ<a href="https://doc.rust-lang.org/stable/proc_macro/index.html"><code>proc_macro</code></a>çš„<code>TokenStream</code>äº’ç›¸è½¬æ¢ã€‚å®é™…ä¸Šè¿™ä¸ªåº“çš„ä½¿ç”¨ï¼Œåªæ˜¯åœ¨æœ€åè¿”å›å€¼é‡Œé¢è°ƒç”¨ä¸€ä¸‹<code>into</code>è€Œå·²ã€‚</p>
<h4 id="quote"><code>quote</code> <a href="#quote" class="anchor">ğŸ”—</a></h4><p><code>quote</code>æ˜¯å°†ç¼–å†™çš„ä»£ç è½¬æ¢ä¸º<a href="https://www.rust-lang.org/zh-CN/">Rust</a> tokençš„æ–¹å¼ï¼Œæä¾›ä¸€ç§ç§°ä¹‹ä¸º<code>quasi-quoting</code>çš„æ–¹å¼ï¼Œå°†ä»£ç è§†ä¸ºæ•°æ®ï¼Œå¹¶å¯ä»¥è¿›è¡Œæ’å€¼ã€‚æ¯”è¾ƒå¸¸ç”¨çš„æ˜¯è¿™ä¸¤ä¸ªå®ï¼š<code>parse_quote!</code>ï¼Œ<code>quote!</code>ï¼Œä»¥åŠ<code>format_ident!</code>ã€‚</p>
<h4 id="syn"><code>syn</code> <a href="#syn" class="anchor">ğŸ”—</a></h4><p>è¿™æ˜¯ç¼–å†™è¿‡ç¨‹å®æœ€é‡è¦çš„ä¸€ä¸ªï¼Œå¤§éƒ¨åˆ†æ—¶é—´éƒ½æ˜¯å’Œè¿™ä¸ªåº“è¿›è¡Œæ‰“äº¤é“ï¼Œå®ƒè¡¨ç¤ºäº†ä¸€ä¸ªå®Œæ•´çš„<a href="https://www.rust-lang.org/zh-CN/">Rust</a> è¯­æ³•ï¼Œå¦‚æœçœ‹è¯­è¨€çš„<a href="https://doc.rust-lang.org/nightly/reference/">Reference</a>æ„Ÿè§‰åˆ°æŠ½è±¡ï¼Œæœ€å¥½æ¥è¿™é‡Œçœ‹ä»£ç ï¼Œå®ƒä»¥éå¸¸å…·ä½“çš„ç¼–ç å®ç°å‘Šè¯‰ä½ è¿™ä¸ª<a href="https://doc.rust-lang.org/nightly/reference/">Reference</a>æ˜¯æ€ä¹ˆè¡¨ç¤ºçš„ã€‚</p>
<h4 id="trybuild"><code>trybuild</code> <a href="#trybuild" class="anchor">ğŸ”—</a></h4><p>å¹³å¸¸çš„å•å…ƒæµ‹è¯•æ˜¯ç¼–è¯‘å¥½çš„ä»£ç ï¼Œç„¶åå†è¿è¡Œæµ‹è¯•ç”¨ä¾‹ã€‚ç„¶è€Œè¿‡ç¨‹å®çš„çš„æµ‹è¯•ï¼Œå¤„éœ€è¦æµ‹è¯•æ˜¯å¦ç¼–è¯‘é€šè¿‡ï¼Œä¹Ÿéœ€è¦ç¼–è¯‘å‡ºé”™çš„ç»“æœæ˜¯å¦æ­£ç¡®ã€‚è¿™æ˜¯éœ€è¦è¿™ä¸ª<code>trybuild</code>åº“äº†ã€‚</p>
<h4 id="cargo-expandhttpsgithubcomdtolnaycargo-expand"><a href="https://github.com/dtolnay/cargo-expand"><code>cargo-expand</code></a> <a href="#cargo-expandhttpsgithubcomdtolnaycargo-expand" class="anchor">ğŸ”—</a></h4><p><a href="https://github.com/dtolnay/cargo-expand"><code>cargo-expand</code></a>ç”¨äºå®ä»£ç çš„å±•å¼€ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œéœ€è¦æ­£å¸¸ç¼–è¯‘é€šè¿‡çš„ä»£ç æ‰å¯ä»¥è¿›è¡Œå±•å¼€ã€‚</p>
<p>ä½¿ç”¨è¿™<code>quote</code>, <code>syn</code>, <code>proc_macro2</code>ä¸‰ä¸ªåº“æ¥ç¼–å†™è¿‡ç¨‹å®åï¼Œæ¡†æ¶ä»£ç åŸºæœ¬ä¸€è‡´ï¼Œä¸€èˆ¬æœ‰å¦‚ä¸‹ä¸‰ä¸ªæ­¥éª¤ï¼Œå¦‚ä¸‹æ–¹å¼ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">use</span><span class="w"> </span><span class="n">proc_macro</span>::<span class="n">TokenStream</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">quote</span>::<span class="n">quote</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">syn</span>::<span class="p">{</span><span class="n">parse_macro_input</span><span class="p">,</span><span class="w"> </span><span class="n">DeriveInput</span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cp">#[proc_macro_derive(MyMacro)]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">my_macro</span><span class="p">(</span><span class="n">input</span>: <span class="nc">TokenStream</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">TokenStream</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// å°†è¾“å…¥çš„æ ‡è®°è§£ææˆè¯­æ³•æ ‘
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">parse_macro_input!</span><span class="p">(</span><span class="n">input</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">DeriveInput</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">// ä½¿ç”¨quoteï¼è¿›è¡Œæ’å€¼å¤„ç†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">expanded</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">quote!</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// å°†proc_macro2çš„TokenStreamè½¬æ¢ä¸ºproc_macroçš„TokenStream
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">TokenStream</span>::<span class="n">from</span><span class="p">(</span><span class="n">expanded</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä»¥ä¸‹ï¼Œç¼–å†™ä¸‰ç§å½¢å¼æ˜¯ç¤ºä¾‹ï¼Œæ¥çœ‹ä¸‹ç€ä¸‰ç§å½¢å¼çš„è¿‡ç¨‹è¿‡ç¨‹å®æ€ä¹ˆç¼–å†™ä»¥åŠæ€ä¹ˆä½¿ç”¨ã€‚ç¤ºä¾‹ä»£ç ä»“åº“ï¼š<a href="https://github.com/buf1024/my_macro_demo">https://github.com/buf1024/my_macro_demo</a></p>
<h3 id="ç¤ºä¾‹derive-å¼">ç¤ºä¾‹ï¼š<code>derive</code> å¼ <a href="#%e7%a4%ba%e4%be%8bderive-%e5%bc%8f" class="anchor">ğŸ”—</a></h3><p>å‡è®¾æˆ‘ä»¬éœ€è¦ä¸ºç»“æ„ä½“ç”Ÿæˆä¸€ç³»åˆ—çš„<code>getter</code>å‡½æ•°ï¼Œå½“ç„¶<code>getter</code>çš„åå­—æ˜¯å¯ä»¥è‡ªå®šä¹‰çš„ä¹Ÿå¯ä»¥æ ¹æ®é»˜è®¤çš„å­—æ®µåç§°ç”Ÿæˆï¼Œä¹Ÿå¯ä»¥è®¾ç½®<code>getter</code>çš„å¯è§æ€§ï¼ŒåŒæ—¶æ ¹æ®æ˜¯å¦æ³¨é‡Šç”Ÿæˆå¯¹åº”çš„<code>desc</code>å‡½æ•°ã€‚ä¸éœ€è¦è€ƒè™‘è¿™æ ·çš„åŠŸèƒ½åœ¨å®é™…å·¥ä½œä¸­æ˜¯å¦æœ‰æ„ä¹‰ï¼Œè¿™é‡Œçš„é‡ç‚¹æ˜¯å­¦æ ¡è¿‡ç¨‹å®çš„ç¼–å†™è¿‡ç¨‹ã€‚</p>
<p>é¦–å…ˆç¼–å†™å®å°±æ˜¯ä¸ºäº†ä½¿ç”¨å®ƒï¼Œæ‰€ä»¥ç¬¬ä¸€æ­¥ï¼Œè¦äº†è§£æ˜¯æ€ä¹ˆä½¿ç”¨è¿™ä¸ªå®ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="c1">// é¦–å…ˆå¯ä»¥æ˜¯è¿™æ ·ç®€å•ä½¿ç”¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#[derive(Getters)]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">struct</span> <span class="nc">MyStruct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">data</span>: <span class="nb">String</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// åˆæˆ–è€…æƒ³å˜æ›´ä¸€ä¸‹å®ƒçš„åç§°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#[derive(Getters)]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">struct</span> <span class="nc">MyStruct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cp">#[getter(name=get_fuck_data)]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">data</span>: <span class="nb">String</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// åˆæˆ–è€…æ˜¯è¿™æ ·
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#[derive(Getters)]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">struct</span> <span class="nc">MyStruct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="cp">#[getter(vis=pub(crate))]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cp">#[getter(name=get_fuck_data)]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">data</span>: <span class="nb">String</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// ä»¥åŠå¯èƒ½æœ‰æ³¨é‡Š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#[derive(Getters)]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">struct</span> <span class="nc">MyStruct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="sd">/// è¿™æ˜¯ä¸€ä¸ªdataçš„å±æ€§
</span></span></span><span class="line"><span class="cl"><span class="sd"></span><span class="w">	</span><span class="cp">#[getter(vis=pub(crate))]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cp">#[getter(name=get_fuck_data)]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">data</span>: <span class="nb">String</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// è®¾ç½®æœºæ„ä½“å¯èƒ½å¤æ‚, å¸¦ä¸Šäº†ç”Ÿå‘½å‘¨æœŸå‚æ•°å’Œæ³›å‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#[derive(Getters)]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">struct</span> <span class="nc">MyStruct</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="p">,</span><span class="w"> </span><span class="n">T</span>: <span class="nb">Sync</span><span class="o">+</span><span class="nb">Send</span><span class="o">+</span><span class="n">Constraint</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="cp">#[getter(vis=pub(crate))]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cp">#[getter(name=get_fuck_data)]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">data</span>: <span class="kp">&amp;</span><span class="na">&#39;a</span> <span class="kt">str</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">constraint</span>: <span class="nc">T</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç¡®å®šäº†è¿‡ç¨‹å®çš„ä½¿ç”¨æ–¹å¼åï¼Œæˆ‘å°±å¯ä»¥å¯ä»¥å®šä¹‰æˆ‘ä»¬çš„å¯¼å‡ºå‡½æ•°äº†:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="cp">#[proc_macro_derive(Getters, attributes(getter))]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">getters</span><span class="p">(</span><span class="n">input</span>: <span class="nc">TokenStream</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">TokenStream</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">parse_macro_input!</span><span class="p">(</span><span class="n">input</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">DeriveInput</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">token_stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">expand_getters</span><span class="p">(</span><span class="n">input</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">token_stream</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="n">unwrap_or_else</span><span class="p">(</span><span class="o">|</span><span class="n">e</span><span class="o">|</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">into_compile_error</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="n">into</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬å°†è¾“å…¥<code>token</code>æµè§£æä¸º<code>DeriveInput</code>ï¼Œæ˜¯å› ä¸º<code>DeriveInput</code>å®ç°äº†<code>Parse</code> traitã€‚å®šä¹‰å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">pub</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">Parse</span>: <span class="nb">Sized</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">fn</span> <span class="nf">parse</span><span class="p">(</span><span class="n">input</span>: <span class="nc">ParseStream</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="bp">Self</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">pub</span><span class="w"> </span><span class="k">struct</span> <span class="nc">DeriveInput</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">pub</span><span class="w"> </span><span class="n">attrs</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Attribute</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">pub</span><span class="w"> </span><span class="n">vis</span>: <span class="nc">Visibility</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">pub</span><span class="w"> </span><span class="n">ident</span>: <span class="nc">Ident</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">pub</span><span class="w"> </span><span class="n">generics</span>: <span class="nc">Generics</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">pub</span><span class="w"> </span><span class="n">data</span>: <span class="nc">Data</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">pub</span><span class="w"> </span><span class="k">enum</span> <span class="nc">Data</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Struct</span><span class="p">(</span><span class="n">DataStruct</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Enum</span><span class="p">(</span><span class="n">DataEnum</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Union</span><span class="p">(</span><span class="n">DataUnion</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä»<code>DeriveInput</code>æ‰€å®ç°çš„<code>Parse</code>å’Œ<code>DeriveInput</code>æ•°æ®ç»“æ„å¯ä»¥çœ‹å‡ºï¼Œ<code>derive</code> å¼è¿‡ç¨‹å®åªæ”¯æŒ<code>Struct</code>ï¼Œ<code>Enum</code>å’Œ<code>Union</code>ä¸‰ç§æ•°æ®ç»“æ„ã€‚</p>
<p>å†™è¿‡ç¨‹å®çš„ä¸€ä¸ªé‡è¦çš„å·¥ä½œå°±æ˜¯è·å–æ‰€ä¿®é¥°çš„æ•°æ®ç»“æ„çš„åŸºæœ¬ä¿¡æ¯ï¼Œè€Œå¯¹äº<code>derive</code> å¼è¿‡ç¨‹å®æ¥è¯´ï¼Œè¿™äº›æ•°æ®æ”¾åˆ°<code>attrs</code>è¿™ä¸ªå±æ€§é‡Œé¢ï¼Œç”¨<code>Attribute</code>è¿™ä¸ªç»“æ„æ¥è¡¨ç¤ºï¼Œ<code>Meta</code>åˆ™æ˜¯å­˜å‚¨è¿™æ ·æ•°æ®çš„ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">pub</span><span class="w"> </span><span class="k">struct</span> <span class="nc">Attribute</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">pub</span><span class="w"> </span><span class="n">pound_token</span>: <span class="nc">Token</span><span class="o">!</span><span class="p">[</span>#<span class="p">],</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">pub</span><span class="w"> </span><span class="n">style</span>: <span class="nc">AttrStyle</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">pub</span><span class="w"> </span><span class="n">bracket_token</span>: <span class="nc">token</span>::<span class="n">Bracket</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">pub</span><span class="w"> </span><span class="n">meta</span>: <span class="nc">Meta</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">pub</span><span class="w"> </span><span class="k">enum</span> <span class="nc">Meta</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Path</span><span class="p">(</span><span class="n">Path</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="sd">/// A structured list within an attribute, like `derive(Copy, Clone)`.
</span></span></span><span class="line"><span class="cl"><span class="sd"></span><span class="w">        </span><span class="n">List</span><span class="p">(</span><span class="n">MetaList</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="sd">/// A name-value pair within an attribute, like `feature = &#34;nightly&#34;`.
</span></span></span><span class="line"><span class="cl"><span class="sd"></span><span class="w">        </span><span class="n">NameValue</span><span class="p">(</span><span class="n">MetaNameValue</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Metaæ˜¯ä»€ä¹ˆé¬¼ï¼ŸæŒ‰ç…§<code>syn</code>çš„æ–‡æ¡£ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="w">    </span><span class="sd">/// text
</span></span></span><span class="line"><span class="cl"><span class="sd"></span><span class="w">    </span><span class="sd">/// #[derive(Copy, Clone)]
</span></span></span><span class="line"><span class="cl"><span class="sd"></span><span class="w">    </span><span class="sd">///   ~~~~~~Path
</span></span></span><span class="line"><span class="cl"><span class="sd"></span><span class="w">    </span><span class="sd">///   ^^^^^^^^^^^^^^^^^^^Meta::List
</span></span></span><span class="line"><span class="cl"><span class="sd"></span><span class="w">    </span><span class="sd">///
</span></span></span><span class="line"><span class="cl"><span class="sd"></span><span class="w">    </span><span class="sd">/// #[path = &#34;sys/windows.rs&#34;]
</span></span></span><span class="line"><span class="cl"><span class="sd"></span><span class="w">    </span><span class="sd">///   ~~~~Path
</span></span></span><span class="line"><span class="cl"><span class="sd"></span><span class="w">    </span><span class="sd">///   ^^^^^^^^^^^^^^^^^^^^^^^Meta::NameValue
</span></span></span><span class="line"><span class="cl"><span class="sd"></span><span class="w">    </span><span class="sd">///
</span></span></span><span class="line"><span class="cl"><span class="sd"></span><span class="w">    </span><span class="sd">/// #[test]
</span></span></span><span class="line"><span class="cl"><span class="sd"></span><span class="w">    </span><span class="sd">///   ^^^^Meta::Path
</span></span></span><span class="line"><span class="cl"><span class="sd"></span><span class="w">    </span><span class="sd">/// 
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ³¨é‡Šæ–‡æ¡£æ˜¯è§£æä¸º<code>#[doc = r&quot; Single line doc comments&quot;]</code>çš„ã€‚æ‰€ä»¥ï¼Œæ–‡æ¡£æ³¨é‡Šçš„è·å–ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="kd">let</span><span class="w"> </span><span class="n">doc_str</span>: <span class="nb">String</span> <span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="n">attrs</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="n">iter</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="n">filter</span><span class="p">(</span><span class="o">|</span><span class="n">attr</span><span class="o">|</span><span class="w"> </span><span class="n">attr</span><span class="p">.</span><span class="n">path</span><span class="p">().</span><span class="n">is_ident</span><span class="p">(</span><span class="s">&#34;doc&#34;</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="n">try_fold</span><span class="p">(</span><span class="nb">String</span>::<span class="n">new</span><span class="p">(),</span><span class="w"> </span><span class="o">|</span><span class="n">acc</span><span class="p">,</span><span class="w"> </span><span class="n">attr</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="kd">let</span><span class="w"> </span><span class="n">mnv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="o">&amp;</span><span class="n">attr</span><span class="p">.</span><span class="n">meta</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">syn</span>::<span class="n">Meta</span>::<span class="n">NameValue</span><span class="p">(</span><span class="n">mnv</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">mnv</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">syn</span>::<span class="n">Error</span>::<span class="n">new_spanned</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;expect name value!&#34;</span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="kd">let</span><span class="w"> </span><span class="n">doc_str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="o">&amp;</span><span class="n">mnv</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">syn</span>::<span class="n">Expr</span>::<span class="n">Lit</span><span class="p">(</span><span class="n">syn</span>::<span class="n">ExprLit</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="n">lit</span>: <span class="nc">syn</span>::<span class="n">Lit</span>::<span class="n">Str</span><span class="p">(</span><span class="n">lit</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="o">..</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">})</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">lit</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">syn</span>::<span class="n">Error</span>::<span class="n">new_spanned</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;expect string literal!&#34;</span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nb">Ok</span><span class="p">(</span><span class="fm">format!</span><span class="p">(</span><span class="s">&#34;</span><span class="si">{}</span><span class="se">\n</span><span class="si">{}</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">acc</span><span class="p">,</span><span class="w"> </span><span class="n">doc_str</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">})</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å‰é¢æåˆ°<code>DeriveInput</code>å®ç°äº†<code>Parse</code>traitè¿›è¡Œè§£æï¼Œè€Œæˆ‘ä»¬è¦å¯¹<code>Attribute</code>é‡Œé¢çš„å†…å®¹è¿›è¡Œè§£æï¼Œåˆ™æ˜¯éœ€è¦å®ç°è¯¥traitï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">impl</span><span class="w"> </span><span class="n">Parse</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">GetterMeta</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">fn</span> <span class="nf">parse</span><span class="p">(</span><span class="n">input</span>: <span class="nc">syn</span>::<span class="n">parse</span>::<span class="n">ParseStream</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="bp">Self</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">lookahead</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">.</span><span class="n">lookahead1</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">lookahead</span><span class="p">.</span><span class="n">peek</span><span class="p">(</span><span class="n">kw</span>::<span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="nc">kw</span>::<span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">.</span><span class="n">parse</span><span class="p">()</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="nc">Token</span><span class="o">!</span><span class="p">[</span><span class="o">=</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">.</span><span class="n">parse</span><span class="p">()</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">name</span>: <span class="nc">Ident</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">input</span><span class="p">.</span><span class="n">peek</span><span class="p">(</span><span class="n">LitStr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kd">let</span><span class="w"> </span><span class="n">sl</span>: <span class="nc">LitStr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">.</span><span class="n">parse</span><span class="p">()</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kd">let</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sl</span><span class="p">.</span><span class="n">value</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="fm">format_ident!</span><span class="p">(</span><span class="s">&#34;{}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="n">trim</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">input</span><span class="p">.</span><span class="n">parse</span><span class="p">()</span><span class="o">?</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nb">Ok</span><span class="p">(</span><span class="bp">Self</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">name</span>: <span class="nb">Some</span><span class="p">(</span><span class="n">name</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">vis</span>: <span class="nb">None</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">lookahead</span><span class="p">.</span><span class="n">peek</span><span class="p">(</span><span class="n">kw</span>::<span class="n">vis</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="nc">kw</span>::<span class="n">vis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">.</span><span class="n">parse</span><span class="p">()</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="nc">Token</span><span class="o">!</span><span class="p">[</span><span class="o">=</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">.</span><span class="n">parse</span><span class="p">()</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">vis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">.</span><span class="n">parse</span><span class="p">()</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nb">Ok</span><span class="p">(</span><span class="bp">Self</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">name</span>: <span class="nb">None</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">vis</span>: <span class="nb">Some</span><span class="p">(</span><span class="n">vis</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nb">Err</span><span class="p">(</span><span class="n">lookahead</span><span class="p">.</span><span class="n">error</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å†™æ³•å¯ä»¥å®Œå…¨å‚è€ƒ<code>DeriveInput</code>çš„å†™æ³•ï¼Œè°ƒç”¨<code>Atrribute</code>çš„ï¼Œ<code>parse_args</code>æˆ–<code>parse_args_with</code>ï¼Œåˆ™å¯ä»¥è°ƒç”¨åˆ°<code>Parse</code>traitã€‚</p>
<p>è·å–åˆ°åŸºæœ¬çš„æ•°æ®åï¼Œè‡ªç„¶å°±ç”Ÿæˆä»£ç ï¼Œè¿™é‡Œä¸¤ä¸ªé‡è¦çš„å®: <code>quote!</code>å’Œ<code>parse_quote!</code>ã€‚æœ€åç”Ÿæˆçš„ä»£ç ç”¨<code>#[automatically_derived]</code>è¿›è¡Œè£…é¥°ï¼Œè¯´æ˜è¿™æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ä»£ç ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">impl_generic</span><span class="p">,</span><span class="w"> </span><span class="n">type_generic</span><span class="p">,</span><span class="w"> </span><span class="n">where_clause</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">.</span><span class="n">generics</span><span class="p">.</span><span class="n">split_for_impl</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nb">Ok</span><span class="p">(</span><span class="fm">quote!</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="cp">#[automatically_derived]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">impl</span><span class="w"> </span>#<span class="n">impl_generic</span><span class="w"> </span>#<span class="n">st_name</span><span class="w"> </span>#<span class="n">type_generic</span><span class="w"> </span>#<span class="n">where_clause</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">hello</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="fm">println!</span><span class="p">(</span><span class="s">&#34;hello!&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>#<span class="n">getters</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">})</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿‡ç¨‹å®å†™å¥½ä¹‹åï¼Œæˆ‘ä»¬å°±è¦å†™å•å…ƒæµ‹è¯•äº†ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å…ˆå†™å•å…ƒæµ‹è¯•ï¼Œå†å†™è¿‡ç¨‹å®ï¼Œè¿™ç§°ä¸ºæµ‹è¯•ç”¨ä¾‹é©±åŠ¨çš„å¼€å‘æ¨¡å¼ã€‚ä¸è¿‡ï¼Œä½œä¸ºç¤ºä¾‹ï¼Œæˆ‘ä»¬ä¸å†™å¾ˆè¯¦ç»†çš„æµ‹è¯•ç”¨ä¾‹ï¼Œæˆ‘ä»¬åªå†™ä¸¤ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œä¸€ä¸ªæ˜¯æˆåŠŸçš„ï¼Œä¸€ä¸ªæ˜¯å¤±è´¥çš„ï¼Œå±•ç¤ºæ€ä¹ˆä½¿ç”¨å³å¯ã€‚å¤±è´¥çš„ç”¨ä¾‹ï¼Œæˆ‘ä»¬éœ€è¦æä¾›ä¸€ä¸ªå’Œæµ‹è¯•æ–‡ä»¶ä¸€è‡´ï¼Œä»¥<code>.stderr</code>ç»“å°¾çš„è¾“å‡ºï¼Œå¦‚æœç¼–è¯‘å™¨çš„è¾“å‡ºä¸€è‡´åˆ™æµ‹è¯•é€šè¿‡ï¼Œè¿™ä¸ªè¾“å‡ºå¯ä»¥å…ˆç¼–è¯‘å‡ºæ¥ï¼Œè®©ç¼–è¯‘å™¨ç”Ÿæˆï¼Œç„¶åè‡ªå·±å¯¹æ¯”æ˜¯ä¸æ˜¯è‡ªå·±æƒ³è¦çš„ç»“æœã€‚</p>
<p>è¿‡ç¨‹å®ä½¿ç”¨åï¼Œæ˜¯å¦ç¬¦åˆè‡ªå·±çš„éœ€è¦ï¼Œéœ€è¦å®å±•å¼€æ¥è§‚å¯Ÿï¼Œä½¿ç”¨æ˜¯<code>cargo exand</code>å‘½ä»¤ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="cp">#![allow(dead_code)]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">my_derive</span>::<span class="n">Getters</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cp">#[derive(Getters)]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">struct</span> <span class="nc">MyStructRef</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="sd">/// ä½ å¥½å‘€
</span></span></span><span class="line"><span class="cl"><span class="sd"></span><span class="w">    </span><span class="cp">#[getter(vis=pub(crate))]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cp">#[getter(name = </span><span class="s">&#34;get_fuck_data&#34;</span><span class="cp">)]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">data</span>: <span class="kp">&amp;</span><span class="na">&#39;a</span> <span class="kt">str</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//å±•å¼€ä»£ç 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cp">#![feature(prelude_import)]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cp">#![allow(dead_code)]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cp">#[prelude_import]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">prelude</span>::<span class="n">rust_2021</span>::<span class="o">*</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cp">#[macro_use]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">extern</span><span class="w"> </span><span class="k">crate</span><span class="w"> </span><span class="n">std</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">my_derive</span>::<span class="n">Getters</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">struct</span> <span class="nc">MyStructRef</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="sd">/// ä½ å¥½å‘€
</span></span></span><span class="line"><span class="cl"><span class="sd"></span><span class="w">    </span><span class="cp">#[getter(vis = pub(crate))]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cp">#[getter(name = </span><span class="s">&#34;get_fuck_data&#34;</span><span class="cp">)]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">data</span>: <span class="kp">&amp;</span><span class="na">&#39;a</span> <span class="kt">str</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cp">#[automatically_derived]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">impl</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="o">&gt;</span><span class="w"> </span><span class="n">MyStructRef</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">hello</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>::<span class="n">std</span>::<span class="n">io</span>::<span class="n">_print</span><span class="p">(</span><span class="fm">format_args!</span><span class="p">(</span><span class="s">&#34;hello!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">pub</span><span class="p">(</span><span class="k">crate</span><span class="p">)</span><span class="w"> </span><span class="k">fn</span> <span class="nf">get_fuck_data</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="na">&#39;a</span> <span class="kt">str</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">data</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">get_fuck_data_desc</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nb">&#39;static</span> <span class="kt">str</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;ä½ å¥½å‘€&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ç¤ºä¾‹å±æ€§å¼">ç¤ºä¾‹ï¼šå±æ€§å¼ <a href="#%e7%a4%ba%e4%be%8b%e5%b1%9e%e6%80%a7%e5%bc%8f" class="anchor">ğŸ”—</a></h3><p>å‡è®¾æˆ‘ä»¬æœ‰è¿™æ ·ä¸€ä¸ªéœ€æ±‚ï¼Œå¯ä»¥å¯¹åŸæœ‰å‡½æ•°è¿›è¡Œå¢åŠ ä¸€äº›å…¶ä»–åŠŸèƒ½ï¼Œæ¯”å¦‚<code>retry</code>ï¼Œå¯ä»¥è®¾ç½®è°ƒç”¨è¶…æ—¶æ—¶é—´ï¼Œè¶…æ—¶åæˆ–è€…å‡ºé”™åï¼Œå¯ä»¥è¿›è¡Œé‡æ–°è°ƒç”¨ï¼Œç±»ä¼¼äºPythonè£…é¥°å™¨ï¼Œå¯ä»¥è€ƒè™‘ç”¨å±æ€§å¼è¿‡ç¨‹å®è¡¨ç¤ºã€‚åŒæ ·ï¼Œå› ä¸ºæ˜¯æµ‹è¯•ä¾‹å­ï¼Œæ‰€ä»¥ï¼Œæ²¡æœ‰è¶…æ—¶å’Œé‡è¯•åŠŸèƒ½ï¼Œåªåšæ€ä¹ˆè·å–å±æ€§å®çš„æ•°æ®å’Œç”Ÿæˆä»£ç ã€‚</p>
<p>é¦–å…ˆç¡®å®šè°ƒç”¨çš„å½¢å¼ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="cp">#[retry(times=5, timeout=60)]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">remote_request</span><span class="p">(</span><span class="n">a</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">b</span>: <span class="kt">i32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">i32</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">&#34;@remote_request!&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å†ç¡®å®šå…¶å±•å¼€å½¢å¼ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="c1">// cargo exapnd ç”Ÿæˆçš„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">fn</span> <span class="nf">remote_request</span><span class="p">(</span><span class="n">a</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">b</span>: <span class="kt">i32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">i32</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">fn</span> <span class="nf">__new_remote_request</span><span class="p">(</span><span class="n">a</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">b</span>: <span class="kt">i32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">i32</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>::<span class="n">std</span>::<span class="n">io</span>::<span class="n">_print</span><span class="p">(</span><span class="fm">format_args!</span><span class="p">(</span><span class="s">&#34;@remote_request!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="mi">5</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">__new_remote_request</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="mi">60</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">__new_remote_request</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">__new_remote_request</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å±æ€§å¼çš„ç­¾åæ˜¯è¿™ä¸ªæ ·å­çš„ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="cp">#[proc_macro_attribute]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">retry</span><span class="p">(</span><span class="n">attr</span>: <span class="nc">TokenStream</span><span class="p">,</span><span class="w"> </span><span class="n">input</span>: <span class="nc">TokenStream</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">TokenStream</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å±æ€§å’Œè¾“å…¥æµå·²ç»ä½œä¸ºå‚æ•°ä¼ é€’ç»™æˆ‘ä»¬äº†ï¼Œè€Œæˆ‘éœ€æ‰€è¦åšçš„æ˜¯éœ€è¦å°†å±æ€§è§£æå‡ºæ¥å’Œå¯¹åŸå‡½æ•°çš„é‡å†™ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">item_fn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">parse_macro_input!</span><span class="p">(</span><span class="n">input</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ItemFn</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">parse_macro_input!</span><span class="p">(</span><span class="n">attr</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Args</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å’Œ<code>derive</code>å¼çš„ä¸€æ ·ï¼Œé€šè¿‡å®ç°<code>Parse</code>traitæ¥è§£æï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">impl</span><span class="w"> </span><span class="n">Parse</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">RetryAttr</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">fn</span> <span class="nf">parse</span><span class="p">(</span><span class="n">input</span>: <span class="nc">syn</span>::<span class="n">parse</span>::<span class="n">ParseStream</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="bp">Self</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">lookahead</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">.</span><span class="n">lookahead1</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">lookahead</span><span class="p">.</span><span class="n">peek</span><span class="p">(</span><span class="n">kw</span>::<span class="n">times</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="nc">kw</span>::<span class="n">times</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">.</span><span class="n">parse</span><span class="p">()</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="nc">Token</span><span class="o">!</span><span class="p">[</span><span class="o">=</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">.</span><span class="n">parse</span><span class="p">()</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">times</span>: <span class="nc">LitInt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">input</span><span class="p">.</span><span class="n">peek</span><span class="p">(</span><span class="n">LitInt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">input</span><span class="p">.</span><span class="n">parse</span><span class="p">()</span><span class="o">?</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">lookahead</span><span class="p">.</span><span class="n">error</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nb">Ok</span><span class="p">(</span><span class="bp">Self</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">times</span>: <span class="nb">Some</span><span class="p">(</span><span class="n">times</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">timeout</span>: <span class="nb">None</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">lookahead</span><span class="p">.</span><span class="n">peek</span><span class="p">(</span><span class="n">kw</span>::<span class="n">timeout</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="nc">kw</span>::<span class="n">timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">.</span><span class="n">parse</span><span class="p">()</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="nc">Token</span><span class="o">!</span><span class="p">[</span><span class="o">=</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">.</span><span class="n">parse</span><span class="p">()</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">timeout</span>: <span class="nc">LitInt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">input</span><span class="p">.</span><span class="n">peek</span><span class="p">(</span><span class="n">LitInt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">input</span><span class="p">.</span><span class="n">parse</span><span class="p">()</span><span class="o">?</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">lookahead</span><span class="p">.</span><span class="n">error</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nb">Ok</span><span class="p">(</span><span class="bp">Self</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">times</span>: <span class="nb">None</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">timeout</span>: <span class="nb">Some</span><span class="p">(</span><span class="n">timeout</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nb">Err</span><span class="p">(</span><span class="n">lookahead</span><span class="p">.</span><span class="n">error</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ç¤ºä¾‹å‡½æ•°å¼">ç¤ºä¾‹ï¼šå‡½æ•°å¼ <a href="#%e7%a4%ba%e4%be%8b%e5%87%bd%e6%95%b0%e5%bc%8f" class="anchor">ğŸ”—</a></h3><p>å‡è®¾æˆ‘ä»¬è¦è®¡ç®—äºŒå…ƒäºŒæ¬¡æ–¹ç¨‹ç»„çš„å€¼ï¼Œæˆ‘ä»¬è®¡åˆ’æ˜¯è¿™æ ·ä½¿ç”¨çš„ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">formula!</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">9</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªå®ç›´æ¥å°±åœ¨ç¼–è¯‘æœŸé—´å°±è®¡ç®—å‡ºxï¼Œyçš„å€¼ï¼ˆå½“ç„¶æ˜¯å­˜åœ¨æœ‰è§£çš„æƒ…å†µä¸‹ï¼‰ï¼Œæ— è§£å°±<code>panic</code>ã€‚ä¸ºäº†ä½¿é—®é¢˜ç®€å•ï¼Œæˆ‘ä»¬å‡è®¾xï¼Œyå‰é¢éƒ½æ˜¯æœ‰ç³»æ•°çš„ã€‚è¿‡ç¨‹å®çš„æ“ä½œè¿‡ç¨‹å°±æ˜¯è§£æå‡ºé‡Œé¢çš„è¡¨è¾¾å¼ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">pub</span><span class="p">(</span><span class="k">crate</span><span class="p">)</span><span class="w"> </span><span class="k">struct</span> <span class="nc">FormulaArgs</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">formula</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Formula</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Parse</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">FormulaArgs</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">fn</span> <span class="nf">parse</span><span class="p">(</span><span class="n">input</span>: <span class="nc">syn</span>::<span class="n">parse</span>::<span class="n">ParseStream</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="bp">Self</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">attrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Punctuated</span>::<span class="o">&lt;</span><span class="n">Formula</span><span class="p">,</span><span class="w"> </span><span class="fm">Token!</span><span class="p">[,]</span><span class="o">&gt;</span>::<span class="n">parse_terminated</span><span class="p">(</span><span class="n">input</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">formula</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">attrs</span><span class="p">.</span><span class="n">into_iter</span><span class="p">().</span><span class="n">collect</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">formula</span><span class="p">.</span><span class="n">len</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="fm">panic!</span><span class="p">(</span><span class="s">&#34;require two formula&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nb">Ok</span><span class="p">(</span><span class="n">FormulaArgs</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">formula</span><span class="w"> </span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cp">#[derive(Default)]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">pub</span><span class="p">(</span><span class="k">crate</span><span class="p">)</span><span class="w"> </span><span class="k">struct</span> <span class="nc">Formula</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">x</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">y</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">rs</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Parse</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Formula</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">fn</span> <span class="nf">parse</span><span class="p">(</span><span class="n">input</span>: <span class="nc">syn</span>::<span class="n">parse</span>::<span class="n">ParseStream</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="bp">Self</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">lookahead</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">.</span><span class="n">lookahead1</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">lookahead</span><span class="p">.</span><span class="n">peek</span><span class="p">(</span><span class="n">LitInt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">x_lit</span>: <span class="nc">LitInt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">.</span><span class="n">parse</span><span class="p">()</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span>: <span class="kt">i32</span> <span class="o">=</span><span class="w"> </span><span class="n">x_lit</span><span class="p">.</span><span class="n">to_string</span><span class="p">().</span><span class="n">parse</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="nc">Token</span><span class="o">!</span><span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">.</span><span class="n">parse</span><span class="p">()</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="nc">kw</span>::<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">.</span><span class="n">parse</span><span class="p">()</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">x</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">lookahead</span><span class="p">.</span><span class="n">error</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">r1</span>: <span class="nb">Result</span><span class="o">&lt;</span><span class="fm">Token!</span><span class="p">[</span><span class="o">+</span><span class="p">]</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">.</span><span class="n">parse</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">r2</span>: <span class="nb">Result</span><span class="o">&lt;</span><span class="fm">Token!</span><span class="p">[</span><span class="o">-</span><span class="p">]</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">.</span><span class="n">parse</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">factor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="p">(</span><span class="n">r1</span><span class="p">,</span><span class="w"> </span><span class="n">r2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">(</span><span class="nb">Ok</span><span class="p">(</span><span class="n">_</span><span class="p">),</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">_</span><span class="p">))</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">(</span><span class="nb">Err</span><span class="p">(</span><span class="n">_</span><span class="p">),</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="n">_</span><span class="p">))</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">(</span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">lookahead</span><span class="p">.</span><span class="n">error</span><span class="p">()),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// let factor = if lookahead.peek(Token![+]) {
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//     let _: Token![+] = input.parse()?;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//     1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">// } else if lookahead.peek(Token![-]) {
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//     let _: Token![-] = input.parse()?;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//     -1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">// } else {
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//     return Err(lookahead.error());
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">// };
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">lookahead</span><span class="p">.</span><span class="n">peek</span><span class="p">(</span><span class="n">LitInt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">y_lit</span>: <span class="nc">LitInt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">.</span><span class="n">parse</span><span class="p">()</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">y</span>: <span class="kt">i32</span> <span class="o">=</span><span class="w"> </span><span class="n">y_lit</span><span class="p">.</span><span class="n">to_string</span><span class="p">().</span><span class="n">parse</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="nc">Token</span><span class="o">!</span><span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">.</span><span class="n">parse</span><span class="p">()</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="nc">kw</span>::<span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">.</span><span class="n">parse</span><span class="p">()</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">factor</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">lookahead</span><span class="p">.</span><span class="n">error</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="nc">Token</span><span class="o">!</span><span class="p">[</span><span class="o">=</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">.</span><span class="n">parse</span><span class="p">()</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">rs_lit</span>: <span class="nc">LitInt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">.</span><span class="n">parse</span><span class="p">()</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">rs</span>: <span class="kt">i32</span> <span class="o">=</span><span class="w"> </span><span class="n">rs_lit</span><span class="p">.</span><span class="n">to_string</span><span class="p">().</span><span class="n">parse</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">rs</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">syn</span>::<span class="n">Error</span>::<span class="n">new_spanned</span><span class="p">(</span><span class="n">rs_lit</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;invalid equal&#34;</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nb">Ok</span><span class="p">(</span><span class="bp">Self</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">rs</span><span class="w"> </span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å½“è§£æå‡ºæ‰€éœ€è¦çš„æ•°æ®åï¼Œç›´æ¥å°±å¯ä»¥è¿›è¡Œæ’å€¼ç”Ÿæˆè‡ªå·±æ‰€éœ€è¦çš„æ•°æ®ã€‚</p>
<h3 id="æ€»ç»“">æ€»ç»“ <a href="#%e6%80%bb%e7%bb%93" class="anchor">ğŸ”—</a></h3><p>è¿‡ç¨‹å®çš„ç¼–å†™è¿‡ç¨‹æœ‰ä¸¤ä¸ªæ­¥éª¤ã€‚</p>
<p>é¦–å…ˆæ˜¯è§£æå‡ºè¿‡ç¨‹å®æ‰€éœ€è¦çš„ä¿¡æ¯ï¼Œè¿™ä¸ªæ­¥éª¤ä¸€èˆ¬æ˜¯é€šè¿‡å®ç°<code>syn</code>æ‰€æä¾›çš„<code>Parse</code>traitå®ç°çš„ã€‚ç”±äºsynè¡¨ç¤ºçš„ä¹Ÿæ˜¯åˆæ³•çš„è¯­æ³•ç»“æ„ï¼Œæ‰€ä»¥å¹¶ä¸æ˜¯æ‰€ä»¥çš„å†™æ³•éƒ½æ˜¯æ”¯æŒçš„ã€‚æœ‰æ—¶å€™ï¼Œè§£æçš„æ—¶å€™å‡ºå‡ºç°ä¸€äº›è«åå¥‡å¦™è§£æä¸äº†çš„é—®é¢˜ï¼Œæ¯”å¦‚è§£æäºŒå…ƒæ–¹ç¨‹æ—¶ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="w">       </span><span class="c1">// let factor = if lookahead.peek(Token![+]) {
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//     let _: Token![+] = input.parse()?;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//     1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">// } else if lookahead.peek(Token![-]) {
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//     let _: Token![-] = input.parse()?;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//     -1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">// } else {
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//     return Err(lookahead.error());
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">// };
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ®µä»£ç æ€»æ˜¯æ— æ³•è§£ææˆåŠŸï¼ŒåŸå› æœªè§£ï¼Œæˆ–è€…ä½¿ç”¨å§¿åŠ¿ä¸å¯¹ï¼Œåˆæˆ–è€…æ˜¯<code>syn</code>å¯èƒ½æ½œåœ¨æœ‰<code>bug</code>ã€‚ä¸è¿‡éƒ½æœ‰å˜é€šçš„æ–¹æ³•å®ç°ã€‚</p>
<p>å…¶æ¬¡è§£æå‡ºè‡ªå·±æ‰€è¦çš„æ•°æ®åï¼Œå°±å¯ä»¥æ ¹æ®å…·ä½“çš„æƒ…å†µè¿›è¡Œæ’å€¼å¤„ç†ï¼Œåªæœ‰æ˜¯ä½¿ç”¨åˆ°<code>quote</code>è¿™ä¸ªåº“ï¼Œè€Œå¤§å¤šæ•°æƒ…å†µä¹‹ä¸‹åªä½¿ç”¨åˆ°ä¸¤ä¸ªå®: <code>quote!</code>å’Œ<code>parse_quote!</code>ã€‚å½“ç„¶ä¹Ÿä¸æ˜¯è¯´æ²¡æœ‰å‘ã€‚æ¯”å¦‚è¯´è§£æå‡ºå‡½æ•°çš„<code>block</code>æ—¶ï¼Œå†é‡ç»„æ—¶ï¼Œè¦åŠ ä¸Šå¤§æ‰©å·ã€‚å†æ¯”å¦‚ï¼Œè§£æå‡ºè¡Œæ•°è°ƒç”¨åˆ—è¡¨æ—¶ï¼Œè§£ææˆä¸€ä¸ªå…ƒç»„è¡¨è¾¾å¼ï¼Œè€Œæ’å€¼æ—¶ï¼Œå¯ä»¥æ”¾ä¸ªå‡½æ•°åç§°åœ¨å‰é¢ï¼Œå°±å˜æˆäº†å‡½æ•°è°ƒç”¨ã€‚è€Œè¿™äº›éƒ½æ˜¯å˜æˆè¿‡ç¨‹å®ç¼–å†™çš„æƒ¯ä¾‹å§ï¼Œä¹ æƒ¯å°±å¥½ã€‚</p>
<p>é”™è¯¯å¤„ç†æ˜¯ç»™å®çš„ä½¿ç”¨è€…çœ‹çš„ï¼Œå‹å¥½çš„é”™è¯¯æç¤ºå¾ˆå®¹æ˜“å°±è®©è°ƒç”¨è€…çŸ¥é“å“ªé‡Œé”™äº†ã€‚è€Œä½¿ç”¨é”™è¯¯å¤„ç†æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œç›´æ¥æ‰ç”¨<code>syn::Error</code>ç”Ÿæˆä¸€ä¸ª<code>Span</code>å³å¯ï¼Œ<code>Span</code>ä¹Ÿæ˜¯å¯ä»¥<code>combine</code>çš„é‡Œé¢æœ‰ä¸ª<code>token</code>çš„å‚æ•°ã€‚ä¸è¿‡å¦‚æœä¸çŸ¥é“<code>token</code>çš„æƒ…å†µä¹‹ä¸‹æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿç›®å‰è‡ªå·±çš„åšæ³•æ˜¯<code>panic</code>ï¼Œè¿™å¹¶éæ˜¯ä¸€ç§æ˜æ™ºçš„æ–¹å¼ã€‚æˆ–è€…æœ‰æ›´åŠ çµæ´»çš„å¤„ç†æ–¹å¼ã€‚</p>
<p>ä½¿ç”¨<code>cargo expand</code>æ˜¯å¯ä»¥æŸ¥çœ‹åˆ°å®å±•å¼€çš„å†…å®¹ï¼Œä¸è¿‡<code>cargo expand</code>çš„é—®é¢˜æ˜¯è¿‡ç¨‹å®æ²¡æœ‰é—®é¢˜æ—¶ï¼Œæ‰å¯ä»¥æ­£å¸¸çš„å±•å¼€ï¼Œå‡ºç°ç¼–è¯‘é—®é¢˜ä¸å±•å¼€ï¼Œè¿™ä¹Ÿå°±é€ æˆäº†è°ƒè¯•è¿‡ç¨‹å®çš„å›°éš¾ï¼Œç›®å‰ä¹Ÿæ²¡æœ‰ä»€ä¹ˆå¥½çš„åŠæ³•å»è§£å†³ã€‚</p>
<p>æ€»ä½“æ¥è¯´ï¼Œè¿‡ç¨‹å®çš„ç¼–å†™å¹¶ä¸æ˜¯éå¸¸å›°éš¾ï¼Œ<code>syn</code>è¡¨ç¤ºäº†ä¸€ä¸ªå®Œæ•´çš„<a href="https://www.rust-lang.org/zh-CN/">Rust</a>è¯­æ³•ï¼ŒæŸ¥çœ‹é‡Œé¢è¯­æ³•çš„è¡¨ç¤ºï¼Œæ¯”çœ‹è¯­è¨€<a href="https://doc.rust-lang.org/nightly/reference/items.html">Reference</a>å¼ºå¤ªå¤šäº†ï¼Œè€Œè¿™å¯¹äºæ›´æ·±å…¥äº†è§£å£°æ˜å®çš„<a href="https://doc.rust-lang.org/nightly/reference/macros-by-example.html#metavariables">ç‰‡æ®µåˆ†ç±»ç¬¦</a>æ›´æœ‰å¸®åŠ©ï¼<a href="https://github.com/dtolnay/proc-macro-workshop">proc-macro-workshop</a> æ˜¯å¤§ç¥<a href="https://github.com/dtolnay">dtolnay</a>è®¾è®¡çš„è¿‡ç¨‹å®ç³»ç»Ÿï¼Œå…¨éƒ¨åšå‡ºæ¥ï¼Œä¼°è®¡å†™è¿‡ç¨‹å®æ²¡æœ‰ä»€ä¹ˆé—®é¢˜äº†ã€‚</p>
<p>å†è´´ä¸€ä¸‹ç¤ºä¾‹ä»£ç ä»“åº“ï¼š<a href="https://github.com/buf1024/my_macro_demo">https://github.com/buf1024/my_macro_demo</a></p>

    </div>

    
</section>


                <hr>
                

<div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js" crossorigin="anonymous"></script>
    <script type="text/javascript">
      var gitalk = new Gitalk({
        id: '2023-12-26 16:00:10 \u002b0800 CST',
        title: 'rust è¿‡ç¨‹å®',
        clientID: '72786bf87c19beec6abe',
        clientSecret: '93ce647699b49ea6434332d36b0122a4ad8281ad',
        repo: 'buf1024.github.io',
        owner: 'buf1024',
        admin: ['buf1024'],
        body: decodeURI(location.href)
      });
      gitalk.render('gitalk-container');
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/gitalk/gitalk">comments powered by gitalk.</a></noscript>

            </div>
        </div>

        <div class="side">
            
            <div class="side-recent">
    <h2 class="side-title">
        <a href="/post/">Recent Post</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/post/2024-01-08-%E5%89%8D%E7%AB%AF%E4%BF%9D%E5%A7%86%E7%BA%A7%E9%85%8D%E7%BD%AE/">å‰ç«¯ä¿å§†çº§é…ç½®</a>
            </li>
        
            <li>
                <a href="/post/2023-12-26-rust-proc-macro/">rust è¿‡ç¨‹å®</a>
            </li>
        
            <li>
                <a href="/post/2023-09-21-rust-panic/">ä¸€è¡Œä»£ç è®© rustc panic</a>
            </li>
        
            <li>
                <a href="/post/2023-07-19-flutter-muti-window/">Flutter æ¡Œé¢ç«¯å¤šçª—å£æ”¯æŒ</a>
            </li>
        
            <li>
                <a href="/post/2023-07-04-hiqradio/">hiqradio ä¸€ä¸ªç®€å•çš„æ”¶éŸ³æœºè½¯ä»¶</a>
            </li>
        
    </ul>
</div>

            
            <div class="side-recent">
    <h2 class="side-title">
        <a href="/talib-doc/">Recent Talib doc</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/talib-doc/func_groups/math_operators/">16 æ•°å­¦è¿ç®—ç¬¦(Math Operator Functions )</a>
            </li>
        
            <li>
                <a href="/talib-doc/func_groups/math_transform/">15 æ•°å­¦å˜æ¢(Math Transform Functions)</a>
            </li>
        
            <li>
                <a href="/talib-doc/func_groups/statistic_functions/">14 ç»Ÿè®¡åŠŸèƒ½(Statistic Functions)</a>
            </li>
        
            <li>
                <a href="/talib-doc/func_groups/pattern_recognition/">13 å½¢æ€è¯†åˆ«(Pattern Recognition Functions)</a>
            </li>
        
            <li>
                <a href="/talib-doc/func_groups/cycle_indicators/">12 å‘¨æœŸæŒ‡æ ‡(Cycle Indicator Functions)</a>
            </li>
        
    </ul>
</div>

            
            <div class="side-categories">
    <h2>Categories</h2>
    <hr />

    <ul>
        
            <li>
                <a href="/categories/android">android(1)</a>
            </li>
        
            <li>
                <a href="/categories/app">app(1)</a>
            </li>
        
            <li>
                <a href="/categories/asm">asm(2)</a>
            </li>
        
            <li>
                <a href="/categories/c">c(6)</a>
            </li>
        
            <li>
                <a href="/categories/django">django(1)</a>
            </li>
        
            <li>
                <a href="/categories/flutter">flutter(7)</a>
            </li>
        
            <li>
                <a href="/categories/frontend">frontend(1)</a>
            </li>
        
            <li>
                <a href="/categories/gcc">gcc(2)</a>
            </li>
        
            <li>
                <a href="/categories/gdb">gdb(1)</a>
            </li>
        
            <li>
                <a href="/categories/git">git(2)</a>
            </li>
        
            <li>
                <a href="/categories/go">go(1)</a>
            </li>
        
            <li>
                <a href="/categories/http">http(1)</a>
            </li>
        
            <li>
                <a href="/categories/https">https(1)</a>
            </li>
        
            <li>
                <a href="/categories/linux">linux(7)</a>
            </li>
        
            <li>
                <a href="/categories/mac">mac(1)</a>
            </li>
        
            <li>
                <a href="/categories/misc">misc(9)</a>
            </li>
        
            <li>
                <a href="/categories/multi_window">multi_window(1)</a>
            </li>
        
            <li>
                <a href="/categories/orm">orm(1)</a>
            </li>
        
            <li>
                <a href="/categories/os">os(2)</a>
            </li>
        
            <li>
                <a href="/categories/python">python(4)</a>
            </li>
        
            <li>
                <a href="/categories/reactjs">reactjs(3)</a>
            </li>
        
            <li>
                <a href="/categories/rust">rust(6)</a>
            </li>
        
            <li>
                <a href="/categories/ssh">ssh(1)</a>
            </li>
        
            <li>
                <a href="/categories/tcp">tcp(6)</a>
            </li>
        
            <li>
                <a href="/categories/tdd">tdd(1)</a>
            </li>
        
            <li>
                <a href="/categories/unittest">unittest(2)</a>
            </li>
        
            <li>
                <a href="/categories/vcs">vcs(1)</a>
            </li>
        
            <li>
                <a href="/categories/vim">vim(3)</a>
            </li>
        
            <li>
                <a href="/categories/web">web(2)</a>
            </li>
        
            <li>
                <a href="/categories/webui">webui(1)</a>
            </li>
        
            <li>
                <a href="/categories/windows">windows(1)</a>
            </li>
        
            <li>
                <a href="/categories/%E6%94%B6%E9%9F%B3%E6%9C%BA">æ”¶éŸ³æœº(1)</a>
            </li>
        
            <li>
                <a href="/categories/%E6%9E%84%E6%9E%B6">æ„æ¶(3)</a>
            </li>
        
            <li>
                <a href="/categories/%E9%87%8F%E5%8C%96">é‡åŒ–(2)</a>
            </li>
        
    </ul>
</div>

            <div class="side-tags">
    <h2>Tags</h2>
    <hr />

    <ul>
        
            <li>
                <a href="/tags/android">android (3)</a>
            </li>
        
            <li>
                <a href="/tags/asm">asm (2)</a>
            </li>
        
            <li>
                <a href="/tags/bt">bt (1)</a>
            </li>
        
            <li>
                <a href="/tags/c">c (20)</a>
            </li>
        
            <li>
                <a href="/tags/c&#43;&#43;">c&#43;&#43; (1)</a>
            </li>
        
            <li>
                <a href="/tags/coroutine">coroutine (1)</a>
            </li>
        
            <li>
                <a href="/tags/css">css (2)</a>
            </li>
        
            <li>
                <a href="/tags/django">django (1)</a>
            </li>
        
            <li>
                <a href="/tags/flutter">flutter (6)</a>
            </li>
        
            <li>
                <a href="/tags/frontend">frontend (1)</a>
            </li>
        
            <li>
                <a href="/tags/gas">gas (2)</a>
            </li>
        
            <li>
                <a href="/tags/gcc">gcc (2)</a>
            </li>
        
            <li>
                <a href="/tags/gdb">gdb (1)</a>
            </li>
        
            <li>
                <a href="/tags/git">git (3)</a>
            </li>
        
            <li>
                <a href="/tags/go">go (1)</a>
            </li>
        
            <li>
                <a href="/tags/gtest">gtest (3)</a>
            </li>
        
            <li>
                <a href="/tags/html">html (1)</a>
            </li>
        
            <li>
                <a href="/tags/http">http (2)</a>
            </li>
        
            <li>
                <a href="/tags/https">https (1)</a>
            </li>
        
            <li>
                <a href="/tags/javascript">javascript (1)</a>
            </li>
        
            <li>
                <a href="/tags/jquery">jquery (1)</a>
            </li>
        
            <li>
                <a href="/tags/js">js (2)</a>
            </li>
        
            <li>
                <a href="/tags/libevent">libevent (1)</a>
            </li>
        
            <li>
                <a href="/tags/linux">linux (10)</a>
            </li>
        
            <li>
                <a href="/tags/mac">mac (1)</a>
            </li>
        
            <li>
                <a href="/tags/makefile">makefile (1)</a>
            </li>
        
            <li>
                <a href="/tags/minix3">minix3 (2)</a>
            </li>
        
            <li>
                <a href="/tags/misc">misc (1)</a>
            </li>
        
            <li>
                <a href="/tags/orm">orm (1)</a>
            </li>
        
            <li>
                <a href="/tags/os">os (2)</a>
            </li>
        
            <li>
                <a href="/tags/proc">proc (1)</a>
            </li>
        
            <li>
                <a href="/tags/python">python (7)</a>
            </li>
        
            <li>
                <a href="/tags/react-native">react-native (2)</a>
            </li>
        
            <li>
                <a href="/tags/redis">redis (2)</a>
            </li>
        
            <li>
                <a href="/tags/rpm">rpm (1)</a>
            </li>
        
            <li>
                <a href="/tags/rsa">rsa (1)</a>
            </li>
        
            <li>
                <a href="/tags/rust">rust (3)</a>
            </li>
        
            <li>
                <a href="/tags/rust-lib">rust-lib (3)</a>
            </li>
        
            <li>
                <a href="/tags/server">server (1)</a>
            </li>
        
            <li>
                <a href="/tags/sqlalchemy">sqlalchemy (1)</a>
            </li>
        
            <li>
                <a href="/tags/ssh">ssh (1)</a>
            </li>
        
            <li>
                <a href="/tags/ssl/tls">ssl/tls (1)</a>
            </li>
        
            <li>
                <a href="/tags/tcp">tcp (7)</a>
            </li>
        
            <li>
                <a href="/tags/tcp-optition">tcp-optition (1)</a>
            </li>
        
            <li>
                <a href="/tags/tcpdump">tcpdump (1)</a>
            </li>
        
            <li>
                <a href="/tags/tdd">tdd (2)</a>
            </li>
        
            <li>
                <a href="/tags/tidbit">tidbit (1)</a>
            </li>
        
            <li>
                <a href="/tags/vc">vc (1)</a>
            </li>
        
            <li>
                <a href="/tags/vcs">vcs (3)</a>
            </li>
        
            <li>
                <a href="/tags/vim">vim (3)</a>
            </li>
        
            <li>
                <a href="/tags/vite">vite (1)</a>
            </li>
        
            <li>
                <a href="/tags/webui">webui (1)</a>
            </li>
        
            <li>
                <a href="/tags/win32">win32 (1)</a>
            </li>
        
            <li>
                <a href="/tags/wireshark">wireshark (1)</a>
            </li>
        
            <li>
                <a href="/tags/%E6%9E%84%E6%9E%B6">æ„æ¶ (2)</a>
            </li>
        
            <li>
                <a href="/tags/%E9%87%8F%E5%8C%96">é‡åŒ– (2)</a>
            </li>
        
            <li>
                <a href="/tags/%E6%94%B6%E9%9F%B3%E6%9C%BA">æ”¶éŸ³æœº (1)</a>
            </li>
        
            <li>
                <a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1">å¾®æœåŠ¡ (1)</a>
            </li>
        
            <li>
                <a href="/tags/%E5%BE%AE%E4%BF%A1">å¾®ä¿¡ (1)</a>
            </li>
        
    </ul>
</div>

        </div>
    </main>
    <span class="footer">
    
    <div class="footer-row">
    <span class="footer-item">Copyleft buf2024, since the beginning to forever</span>
    </div>
    
    
</footer>
</body>

</html>